(19)国家知识产权局

(12)发明专利申请

(10)申请公布号 (43)申请公布日

(21)申请号202410267568.3

(22)申请日2024.03.08

(71)申请人北京邮电大学

地址100089 北京市海淀区西土城路10号

(72)发明人张航 李睿凡 吴惠甲 李佩佩 杨智博

(74)专利代理机构石家庄领皓专利代理有限公

司13130 专利代理师赵春雨

(51)Int.Cl.

G06V 40/16(2022.01) G06V 10/774(2022.01)

(54)发明名称

人脸重定向模型、模型训练方法及装置 (57)摘要

本公开提供了一种人脸重定向模型、模型训 练方法及装置，该方法包括：编码器，用于对人脸 图像进行特征提取，得到人脸特征；无关属性分 解模块，用于对所述人脸特征进行特征提取，得 到对应于所述人脸特征的细节特征；所述细节特 征包括身份特征、视线特征和头部特征；交叉属 性分离模块，用于对所述细节特征中的目标特征 进行角度旋转；所述目标特征为视线特征或头部 特征；解码器，用于基于角度旋转后的细节特征 生成人脸图像。本公开提供的人脸重定向模型、 模型训练方法及装置可以提高视线估计算法的 样本集质量。

权利要求书2页 说明书10页 附图3页

CN 118116053 A 2024.05.31

CN 118116053 A

1.一种人脸重定向模型，其特征在于，包括： 编码器，用于对人脸图像进行特征提取，得到人脸特征； 无关属性分解模块，用于对所述人脸特征进行特征提取，得到对应于所述人脸特征的 细节特征；所述细节特征包括身份特征、视线特征和头部特征；

交叉属性分离模块，用于对所述细节特征中的目标特征进行角度旋转；所述目标特征 为视线特征或头部特征；

解码器，用于基于角度旋转后的细节特征生成新的人脸图像。 2.如权利要求1所述的人脸重定向模型，其特征在于，所述对所述细节特征中的目标特 征进行角度旋转，包括：

基于预设的第一旋转矩阵对所述视线特征进行角度旋转，或基于预设的第二旋转矩阵 对所述头部特征进行角度旋转。

3.如权利要求2所述的人脸重定向模型，其特征在于，所述第一旋转矩阵具体为：

其中， 表示第一旋转矩阵， 表示角度变量，j表示第一旋转角度，g表

示视线特征；

所述第二旋转矩阵为：

其中， 表示第二旋转矩阵， 表示角度变量，k表示第二旋转角度，h表

示头部特征。

4.如权利要求1所述的人脸重定向模型，其特征在于，所述目标特征为从视线特征和头 部特征中随机选取的一种特征。

5.一种人脸重定向模型训练方法，其特征在于，包括： 将第一人脸图像和第二人脸图像依次输入至编码器、无关属性分解模块、交叉属性分 离模块中，得到第一细节特征、第二细节特征、角度旋转后的第一目标特征和角度旋转后的 第二目标特征；

所述第一细节特征为对应于第一人脸图像的细节特征，所述第二细节特征为对应于第 二人脸图像的细节特征；所述第一目标特征为第一细节特征中的目标特征，所述第二目标 特征为第二细节特征中的目标特征；所述第一人脸图像和所述第二人脸图像为身份相同、 姿态不同的人脸图像；

将角度旋转后的第一目标特征交换至第二细节特征中，得到特征交换后的第一细节特 征；将角度旋转后的第二目标特征交换至第一细节特征中，得到特征交换后的第二细节特

权 利 要 求 书 1/2 页

CN 118116053 A

将特征交换后的第一细节特征和特征交换后的所述第二细节特征输入至解码器中，生 成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的第四人脸图像；

基于所述第一人脸图像与所述第三人脸图像的相似度、以及所述第二人脸图像和所述 第四人脸图像的相似度对人脸重定向模型中各个模块的参数进行更新，以实现所述人脸重 定向模型的训练。

6.如权利要求5所述的人脸重定向模型训练方法，其特征在于，在所述将特征交换后的 第一细节特征和特征交换后的所述第二细节特征输入至解码器中的步骤之前还包括：

将第一细节特征中的身份特征和第二细节特征中的身份特征进行特征交换。 7.如权利要求5所述的人脸重定向模型训练方法，其特征在于，还包括： 在所述无关属性分解模块的训练中加入正交损失函数计算，所述正交损失函数计算的 公式为：

其中， 表示正交损失，E[ ]表示期望值计算， 表示身份特征， 表示细节特

征中除身份特征之外的特征， 表示视线特征， 表示头部特征， 表示元素乘积。

8.一种人脸重定向模型训练装置，其特征在于，包括： 特征提取模块，用于将第一人脸图像和第二人脸图像依次输入至编码器、无关属性分 解模块、交叉属性分离模块中，得到第一细节特征、第二细节特征、角度旋转后的第一目标 特征和角度旋转后的第二目标特征；

所述第一细节特征为对应于第一人脸图像的细节特征，所述第二细节特征为对应于第 二人脸图像的细节特征；所述第一目标特征为第一细节特征中的目标特征，所述第二目标 特征为第二细节特征中的目标特征；所述第一人脸图像和所述第二人脸图像为身份相同、 姿态不同的人脸图像；

特征交换模块，用于将角度旋转后的第一目标特征交换至第二细节特征中，得到特征 交换后的第一细节特征；将角度旋转后的第二目标特征交换至第一细节特征中，得到特征 交换后的第二细节特征；

图像生成模块，用于将特征交换后的第一细节特征和特征交换后的所述第二细节特征 输入至解码器中，生成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的第四 人脸图像；

参数更新模块，用于基于所述第一人脸图像与所述第三人脸图像的相似度、以及所述 第二人脸图像和所述第四人脸图像的相似度对人脸重定向模型中各个模块的参数进行更 新以实现所述人脸重定向模型的训练。

9.一种电子设备，包括存储器、处理器以及存储在所述存储器中并可在所述处理器上 运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现如权利要求5至7 任一项所述方法的步骤。

10.一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，其特征在 于，所述计算机程序被处理器执行时实现如权利要求5至7任一项所述方法的步骤。

权 利 要 求 书 2/2 页

CN 118116053 A

人脸重定向模型、模型训练方法及装置

[0001] 本公开属于图像处理技术领域，更具体地说，是涉及一种人脸重定向模型、人脸重 定向模型训练方法及装置、电子设备、可读存储介质。

[0002] 现有的视线估计算法可以分为基于模型的方法和基于外观的方法。基于模型的估 计系统从眼睛图像中提取特征，以拟合预测视线角度的几何模型。然而，它们需要专用的眼 动追踪相机来捕捉眼部近距离图像，这限制了它们的广泛应用。相比之下，基于外观的解决 方案依赖于由普通RGB相机拍摄的面部或眼睛图像，如智能手机、平板电脑、和公共显示器 中的相机，这使它们有望用于各个场景。最新的基于外观的视线估计系统受益于深度神经 网络的表示学习能力，显示出显著优于基于模型的同类系统的良好性能。

[0003] 然而深度神经网络需要依赖于一个大规模标记视线数据集进行训练。由于数据采 集过程中的各种限制和条件，采集到的数据质量还不够理想，造成现有视线估计数据集采 集困难，样本丰富性较差。

[0004] 本公开的目的在于提供一种人脸重定向模型、模型训练方法及装置，以提高视线 估计算法的样本集质量。

[0005] 本公开实施例的第一方面，提供了一种人脸重定向模型，包括： 编码器，用于对人脸图像进行特征提取，得到人脸特征； 无关属性分解模块，用于对所述人脸特征进行特征提取，得到对应于所述人脸特 征的细节特征；所述细节特征包括身份特征、视线特征和头部特征；

交叉属性分离模块，用于对所述细节特征中的目标特征进行角度旋转；所述目标 特征为视线特征或头部特征；

解码器，用于基于角度旋转后的细节特征生成新的人脸图像。

[0006] 本公开实施例的第二方面，提供了一种人脸重定向模型训练方法，包括： 将第一人脸图像和第二人脸图像依次输入至编码器、无关属性分解模块、交叉属 性分离模块中，得到第一细节特征、第二细节特征、角度旋转后的第一目标特征和角度旋转 后的第二目标特征；

所述第一细节特征为对应于第一人脸图像的细节特征，所述第二细节特征为对应 于第二人脸图像的细节特征；所述第一目标特征为第一细节特征中的目标特征，所述第二 目标特征为第二细节特征中的目标特征；所述第一人脸图像和所述第二人脸图像为身份相 同、姿态不同的人脸图像；

将角度旋转后的第一目标特征交换至第二细节特征中，得到特征交换后的第一细 节特征；将角度旋转后的第二目标特征交换至第一细节特征中，得到特征交换后的第二细 节特征；

说 明 书 1/10 页

CN 118116053 A

将特征交换后的第一细节特征和特征交换后的所述第二细节特征输入至解码器 中，生成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的第四人脸图像；

基于所述第一人脸图像与所述第三人脸图像的相似度、以及所述第二人脸图像和 所述第四人脸图像的相似度对人脸重定向模型中各个模块的参数进行更新，以实现所述人 脸重定向模型的训练。

[0007] 本公开实施例的第三方面，提供了一种人脸重定向模型训练装置，包括： 特征提取模块，用于将第一人脸图像和第二人脸图像依次输入至编码器、无关属 性分解模块、交叉属性分离模块中，得到第一细节特征、第二细节特征、角度旋转后的第一 目标特征和角度旋转后的第二目标特征；

所述第一细节特征为对应于第一人脸图像的细节特征，所述第二细节特征为对应 于第二人脸图像的细节特征；所述第一目标特征为第一细节特征中的目标特征，所述第二 目标特征为第二细节特征中的目标特征；所述第一人脸图像和所述第二人脸图像为身份相 同、姿态不同的人脸图像；

特征交换模块，用于将角度旋转后的第一目标特征交换至第二细节特征中，得到 特征交换后的第一细节特征；将角度旋转后的第二目标特征交换至第一细节特征中，得到 特征交换后的第二细节特征；

图像生成模块，用于将特征交换后的第一细节特征和特征交换后的所述第二细节 特征输入至解码器中，生成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的 第四人脸图像；

参数更新模块，用于基于所述第一人脸图像与所述第三人脸图像的相似度、以及 所述第二人脸图像和所述第四人脸图像的相似度对人脸重定向模型中各个模块的参数进 行更新以实现所述人脸重定向模型的训练。

[0008] 本公开实施例的第四方面，提供了一种电子设备，包括存储器、处理器以及存储在 所述存储器中并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时 实现上述的人脸重定向模型训练方法的步骤。

[0009] 本公开实施例的第五方面，提供了一种计算机可读存储介质，所述计算机可读存 储介质存储有计算机程序，所述计算机程序被处理器执行时实现上述的人脸重定向模型训 练方法的步骤。

[0010] 本公开实施例提供的人脸重定向模型、模型训练方法及装置的有益效果在于： 本公开实施例中，首先通过编码器对人脸图像进行特征提取得到人脸特征，然后 通过无关属性分解模块对人脸特征进一步提取细节特征，再旋转细节特征中的视线特征或 头部特征，其他细节特征保持不变，最后基于旋转后的细节特征生成新的人脸图像。这样， 通过改变人脸图像的视线特征或头部特征来生成新的图像，对现有视线估计样本集进行数 据增广，能够提高样本集的质量。

[0011] 为了更清楚地说明本公开实施例中的技术方案，下面将对实施例或现有技术描述 中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本公开的一些 实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附

说 明 书 2/10 页

CN 118116053 A

图获得其他的附图。

[0012] 图1为本公开一实施例提供的人脸重定向模型结构示意图； 图2为本公开一实施例提供的人脸重定向模型训练方法的流程示意图； 图3为本公开一实施例提供的人脸重定向模型训练方法的原理框图； 图4为本公开一实施例提供的人脸重定向模型训练装置的结构框图； 图5为本公开一实施例提供的电子设备的示意框图。

具体实施方式

[0013] 以下描述中，为了说明而不是为了限定，提出了诸如特定系统结构、技术之类的具 体细节，以便透彻理解本公开实施例。然而，本领域的技术人员应当清楚，在没有这些具体 细节的其它实施例中也可以实现本公开。在其它情况中，省略对众所周知的系统、装置、电 路以及方法的详细说明，以免不必要的细节妨碍本公开的描述。

[0014] 为使本公开的目的、技术方案和优点更加清楚，下面将结合附图通过具体实施例 来进行说明。

[0015] 请参考图1，图1为本公开一实施例提供的人脸重定向模型的结构示意图，包括： 编码器11，用于对人脸图像进行特征提取，得到人脸特征。

[0016] 无关属性分解模块12，用于对人脸特征进行特征提取，得到对应于人脸特征的细 节特征；细节特征包括身份特征、视线特征和头部特征。

[0017] 交叉属性分离模块13，用于对细节特征中的目标特征进行角度旋转；目标特征为 视线特征或头部特征。

[0018] 解码器14，用于基于角度旋转后的细节特征生成新的人脸图像。

[0019] 本实施例中，编码器的功能可以采用现有的特征提取网络实现，例如卷积神经网 络CNN、循环神经网络RNN、深度残差神经网络ResNet等，这里不做限定。

[0020] 在得到人脸特征 后，本实施例通过无关属性分解模块进一步提取人脸特征 中

的细节特征。具体的，可以通过分解器 从人脸特征 中分解提取人脸身份信

息 ，对于剩余的信息 和身份信息 ，这里使用两个全连接层来分别提

取视线和头部特征 ，以及身份特征 。在进行细节特征提取

过程中，可以将提取得到的视线特征 接入现有的视线估计器进行辅助训练，对视线方向

进行估计，以确保提取到准确的视线特征 ；同理，将提取得到的头部特征 接入现有的视

线估计器进行辅助训练，对头部方向进行估计，以确保提取到准确的头部特征 。

[0021] 在提取得到身份特征、视线特征和头部特征的基础上，通过对其中的视线特征或 头部特征（也即目标特征）进行角度旋转得到角度旋转后的细节特征，并基于角度旋转后的 细节特征生成新的人脸图像，以扩充人脸图像的样本集。进一步，也可以采用同样的方法对 目标特征进行多次角度旋转，例如，在第一次角度旋转时，对视线特征进行角度旋转，得到 视线方向不同的人脸图像；接着在进行第二次角度旋转时，可以对头部特征进行角度旋转， 得到头部方向不同的人脸图像，以此类推，通过多次角度旋转可以得到视线角度和/或头部 角度不同的人脸图像。

说 明 书 3/10 页

CN 118116053 A

[0022] 由上可以得出，本公开实施例中，首先通过编码器对人脸图像进行特征提取得到 人脸特征，然后通过无关属性分解模块对人脸特征进一步提取细节特征，再旋转细节特征 中的视线特征或头部特征，其他细节特征保持不变，最后基于旋转后的细节特征生成新的 人脸图像。这样，通过改变人脸图像的视线特征或头部特征来生成新的图像，对现有视线估 计样本集进行数据增广，能够提高样本集的质量。

在本公开的一种实施例中，对细节特征中的目标特征进行角度旋转，包括： 基于预设的第一旋转矩阵对视线特征进行角度旋转，或基于预设的第二旋转矩阵 对头部特征进行角度旋转。

[0023] 在本实施例中，可以选择对视线特征进行角度旋转，也可以选择对头部特征进行 角度旋转。具体的，可以根据视线特征对应的视线角度和预设的目标视线角度计算第一旋 转矩阵，然后通过第一旋转矩阵对视线特征进行角度旋转；同理，也可以根据头部特征对应 的头部角度和预设的目标头部角度计算第二旋转矩阵，然后通过第二旋转矩阵对头部特征 进行角度旋转。

[0024] 在本公开的一种实施例中，第一旋转矩阵具体为：

[0025] 其中， 表示第一旋转矩阵， 表示角度变量，j表示第一旋转角

度，g表示视线特征。

[0026] 第二旋转矩阵为：

其中， 表示第二旋转矩阵， 表示角度变量，k表示第二旋转角

度，h表示头部特征。

[0027] 在本实施例中，定义了二维的角度变量 来计算旋转

矩阵。其中，第一旋转角度指的是从当前视线特征对应的视线角度到目标视线角度之间的 角度；第二旋转角度指的是从当前头部特征对应的头部角度到目标头部角度之间的角度。

[0028] 在本公开的一种实施例中，目标特征为从视线特征和头部特征中随机选取的一种 特征。

[0029] 在本实施例中，可以从视线特征和头部特征中随机选择一个特征作为目标特征， 通过对目标特征进行角度旋转生成新的人脸图像。这样，有利于生成视线角度和头部角度 随机分布的人脸图像样本集，进一步提升了样本集的丰富性。

[0030] 请参考图2，图2为本公开一实施例提供的人脸重定向模型训练方法的流程示意 图，该方法包括：

说 明 书 4/10 页

CN 118116053 A

S101：将第一人脸图像和第二人脸图像依次输入至编码器、无关属性分解模块、交 叉属性分离模块中，得到第一细节特征、第二细节特征、角度旋转后的第一目标特征和角度 旋转后的第二目标特征。

[0031] 第一细节特征为对应于第一人脸图像的细节特征，第二细节特征为对应于第二人 脸图像的细节特征；第一目标特征为第一细节特征中的目标特征，第二目标特征为第二细 节特征中的目标特征；第一人脸图像和第二人脸图像为身份相同、姿态不同的人脸图像。

[0032] 在本实施例中，发明人经过大量研究发现，现有的合成人脸图像数据的方法在改 变人脸的视线角度和头部角度时可能会导致局部细节的稀释，其主要原因是忽略了视线角 度和头部角度之间的耦合关系。据此，本公开实施例将身份相同、姿态不同（也即视线角度 和/或头部角度不同）的人脸图像输入人脸重定向模型中进行联合训练，可以利用不同视线 角度和头部角度的人脸图像之间的潜在联系，进一步完全解耦视线特征和头部特征，同时 保持其他特征不受影响。

[0033] 以采用两个人脸图像进行联合训练为例，如图3所示，本实施例将两个相同身份、 不同姿态的第一人脸图像Xa、第二人脸图像Xb依次输入模型中，通过编码器编码可以分别得 到图像Xa、Xb对应的人脸特征。在无关属性分解模块（IAD）中，第一人脸图像Xa的人脸特征被

分解为 ，第二人脸图像Xb的人脸特征被分解为 。接着在交叉属性分离

模块中，基于旋转矩阵 对第一人脸图像Xa的视线特征进行角度旋转，得到角度旋转后

的第一目标特征 ，基于旋转矩阵 对第二人脸图像Xb的视线特征进行角度旋转，得到

角度旋转后的第二目标特征 。

[0034] 其中，旋转矩阵 中的旋转角度ab表示从第一人脸图像Xa的视线角度旋转至第

二人脸图像Xb的视线角度的过程中所经过的角度；旋转矩阵 中的旋转角度ba表示从第

二人脸图像Xb的视线角度旋转至第一人脸图像Xa的视线角度的过程中所经过的角度。

[0035] S102：将角度旋转后的第一目标特征交换至第二细节特征中，得到特征交换后的 第一细节特征；将角度旋转后的第二目标特征交换至第一细节特征中，得到特征交换后的 第二细节特征。

[0036] 如图3所示，在本实施例中，第一人脸图像Xa的视线特征进行角度旋转后得到第一

目标特征 ，第二人脸图像Xb的视线特征进行角度旋转后得到第二目标特征 。将第一

目标特征 交换至第二人脸图像Xb的第二细节特征中，以模拟第二人脸图像的视线特

征；同时，将第二目标特征 交换至第一人脸图像Xa的第一细节特征中，以模拟第一人脸

图像的视线特征。

[0037] S103：将特征交换后的第一细节特征和特征交换后的第二细节特征输入至解码器 中，生成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的第四人脸图像。

说 明 书 5/10 页

CN 118116053 A

[0038] 在本实施例中，将第一人脸图像Xa的身份特征 、第二目标特征 和第一人脸

图像Xa的头部特征 输入解码器中，可以生成新的第三人脸图像 ; 同时，将第二人脸图

像Xb的身份特征 、第一目标特征 和第二人脸图像Xb的头部特征 输入解码器中，可

以生成新的第四人脸图像 。

[0039] 需要说明的是，图3所示的实施例中，对第一人脸图像Xa和第二人脸图像Xb均进行 了视线特征的角度旋转，分别得到第一目标特征和第二目标特征。在其他实施例中，也可以 选择对第一人脸图像Xa的视线特征进行角度旋转得到第一目标特征、对第二人脸图像Xb的 头部特征进行角度旋转得到第二目标特征；或者对第一人脸图像Xa的头部特征进行角度旋 转得到第一目标特征、对第二人脸图像Xb的头部特征进行角度旋转得到第二目标特征；或 者对第一人脸图像Xa的视线特征进行角度旋转得到第一目标特征、对第二人脸图像Xb的视 线特征进行角度旋转得到第二目标特征。

[0040] S104：基于第一人脸图像与第三人脸图像的相似度、以及第二人脸图像和第四人 脸图像的相似度对人脸重定向模型中各个模块的参数进行更新以实现人脸重定向模型的 训练。

[0041] 在本实施例中，可以通过比较第一人脸图像与第三人脸图像的相似度、以及第二 人脸图像和第四人脸图像的相似度判断人脸重定向模型的训练效果。当第一人脸图像与第 三人脸图像的相似度、以及第二人脸图像和第四人脸图像的相似度均大于预设相似度时， 表明可以通过单独的视线特征或头部特征的旋转生成新的人脸图像，人脸重定向模型训练 完成。否则可以调整人脸重定向模型中编码器、无关属性分解模块、交叉属性分离模块、解 码器等各模块的参数重新进行训练。

[0042] 由上可以得出，本公开实施例利用身份相同、姿态不同的人脸图像之间的潜在联 系完全解耦视线特征和头部特征，同时保持其他特征不受影响。在视线特征和头部特征完 全解耦的基础上，通过改变人脸图像的视线特征和/或头部特征来生成新的图像，对现有视 线估计样本集进行数据增广，能够提高样本集的质量。

在本公开的一种实施例中，在将特征交换后的第一细节特征和特征交换后的第二 细节特征输入至解码器中的步骤之前还包括：

将第一细节特征中的身份特征和第二细节特征中的身份特征进行特征交换。

[0043] 在本实施例中，第一细节特征中的身份特征和第二细节特征中的身份特征为相同 的特征，将两个人脸图像中相同的特征进行交换，这样可以进行交互式学习，各自学到相应 的属性特征，有利于属性特征之间的分离和解耦。

[0044] 在本公开的一种实施例中，在无关属性分解模块的训练中加入正交损失函数计 算，正交损失函数计算公式为：

其中， 表示正交损失，表示元素乘积。

[0045] 在本实施例中，采用正交损失监督身份特征、视线特征和头部特征的提取，使它们 在隐空间中相互正交。这样有利于更好地进行后续属性编辑，达到解耦的目的。

说 明 书 6/10 页

CN 118116053 A

[0046] 在本公开的一种实施例中，人脸重定向模型训练方法还包括： 通过第一公式计算对抗损失；第一公式包括：

[0047] 其中， 表示鉴别器损失，D表示鉴别器，表示生成的图像，

表示图像真值，E[ ]表示期望值计算， 表示生成器损失。

[0048] 通过 计算重建损失；其中， 表示重建损

失，|| ||1表示L1范数。

[0049] 通过第二公式计算标签损失；第二公式包括：

[0050] 其中， 表示标签损失， 表示视线角度生成标签， 由 经过全连接层得

到， 表示 对应的标签真值； 表示头部角度生成标签， 由 经过全连接层得

到， 表示 对应的标签真值。

[0051] 通过 计算总

损失函数L。

[0052] 在本实施例中，采用生成器G（包括编码器和解码器）重新生成人脸图像，并通过鉴 别器判断生成图像的真实性，对抗损失用于计算生成器和鉴别器的损失。

[0053] 重建损失用于计算生成的图像 和目标图像 之间的L1重建损失。

[0054] 在得到视线特征和头部特征后，可以通过全连接层直接回归到相应的视线方向向

量 和头部方向向量 ，标签损失用于计算视线方向和头部方向伪标签的估计损失。

[0055] 通过将上述对抗损失、重建损失、标签损失和正交损失进行加权求和，可以得到总 损失函数L。当总损失函数L小于设定阈值时，表明重新生成的第三人脸图像和第一人脸图 像的相似度、以及重新生成的第四人脸图像和第二人脸图像的相似度均大于预设相似度， 人脸重定向模型训练完成。

[0056] 对应于上文实施例的人脸重定向模型训练方法，图4为本公开一实施例提供的人 脸重定向模型训练装置的结构框图。为了便于说明，仅示出了与本公开实施例相关的部分。 参考图4，该人脸重定向模型训练装置20包括：特征提取模块21、特征交换模块22、图像生成 模块23和参数更新模块24。

其中，特征提取模块21，用于将第一人脸图像和第二人脸图像依次输入至编码器、 无关属性分解模块、交叉属性分离模块中，得到第一细节特征、第二细节特征、角度旋转后

说 明 书 7/10 页

CN 118116053 A

的第一目标特征和角度旋转后的第二目标特征。

[0057] 第一细节特征为对应于第一人脸图像的细节特征，第二细节特征为对应于第二人 脸图像的细节特征。第一目标特征为第一细节特征中的目标特征，第二目标特征为第二细 节特征中的目标特征。第一人脸图像和第二人脸图像为身份相同、姿态不同的人脸图像。

[0058] 特征交换模块22，用于将角度旋转后的第一目标特征交换至第二细节特征中，得 到特征交换后的第一细节特征；将角度旋转后的第二目标特征交换至第一细节特征中，得 到特征交换后的第二细节特征。

[0059] 图像生成模块23，用于将特征交换后的第一细节特征和特征交换后的第二细节特 征输入至解码器中，生成对应于第一人脸图像的第三人脸图像和对应于第二人脸图像的第 四人脸图像。

[0060] 参数更新模块24，用于基于第一人脸图像与第三人脸图像的相似度、以及第二人 脸图像和第四人脸图像的相似度对人脸重定向模型中各个模块的参数进行更新以实现人 脸重定向模型的训练。

[0061] 在本公开的一种实施例中，在将特征交换后的第一细节特征和特征交换后的第二 细节特征输入至解码器中的步骤之前还包括：

将第一细节特征中的身份特征和第二细节特征中的身份特征进行特征交换。

[0062] 在本公开的一种实施例中，参数更新模块24还用于： 在无关属性分解模块的训练中加入正交损失函数计算，正交损失函数计算的公式 为：

其中， 表示正交损失，表示元素乘积。

[0063] 参见图5，图5为本公开一实施例提供的电子设备的示意框图。如图5所示的本实施 例中的电子设备300可以包括：一个或多个处理器301、一个或多个输入设备302、一个或多 个输出设备303及一个或多个存储器304。上述处理器301、输入设备302、输出设备303及存 储器304通过通信总线305完成相互间的通信。存储器304用于存储计算机程序，计算机程序 包括程序指令。处理器301用于执行存储器304存储的程序指令。其中，处理器301被配置用 于调用程序指令执行上述各装置实施例中各模块/单元的功能，例如图4所示模块21至22的 功能。

[0064] 应当理解，在本公开实施例中，所称处理器301可以是中央处理单元(Central Processing Unit，CPU)，该处理器还可以是其他通用处理器、数字信号处理器(Digital Signal Processor，DSP)、专用集成电路(Application Specific Integrated Circuit， ASIC)、现成可编程门阵列(Field‑Programmable Gate Array，FPGA) 或者其他可编程逻 辑器件、分立门或者晶体管逻辑器件、分立硬件组件等。通用处理器可以是微处理器或者该 处理器也可以是任何常规的处理器等。

[0065] 输入设备302可以包括触控板、指纹采传感器（用于采集用户的指纹信息和指纹的 方向信息）、麦克风等，输出设备303可以包括显示器（LCD等）、扬声器等。

[0066] 该存储器304可以包括只读存储器和随机存取存储器，并向处理器301 提供指令 和数据。存储器304的一部分还可以包括非易失性随机存取存储器。例如，存储器304还可以

说 明 书 8/10 页

CN 118116053 A

存储设备类型的信息。

[0067] 具体实现中，本公开实施例中所描述的处理器301、输入设备302、输出设备303可 执行本公开实施例提供的人脸重定向模型训练方法的第一实施例和第二实施例中所描述 的实现方式，也可执行本公开实施例所描述的电子设备的实现方式，在此不再赘述。

[0068] 在本公开的另一实施例中提供一种计算机可读存储介质，计算机可读存储介质存 储有计算机程序，计算机程序包括程序指令，程序指令被处理器执行时实现上述实施例方 法中的全部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，计算机程序可 存储于一计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法 实施例的步骤。其中，计算机程序包括计算机程序代码，计算机程序代码可以为源代码形 式、对象代码形式、可执行文件或某些中间形式等。计算机可读介质可以包括：能够携带计 算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只 读存储器（ROM，Read‑Only Memory）、随机存取存储器（RAM，Random Access Memory）、电载 波信号、电信信号以及软件分发介质等。需要说明的是，计算机可读介质包含的内容可以根 据司法管辖区内立法和专利实践的要求进行适当的增减，例如在某些司法管辖区，根据立 法和专利实践，计算机可读介质不包括是电载波信号和电信信号。

[0069] 计算机可读存储介质可以是前述任一实施例的电子设备的内部存储单元，例如电 子设备的硬盘或内存。计算机可读存储介质也可以是电子设备的外部存储设备，例如电子 设备上配备的插接式硬盘，智能存储卡（Smart Media Card , SMC），安全数字（Secure Digital, SD）卡，闪存卡（Flash Card）等。进一步地，计算机可读存储介质还可以既包括电 子设备的内部存储单元也包括外部存储设备。计算机可读存储介质用于存储计算机程序及 电子设备所需的其他程序和数据。计算机可读存储介质还可以用于暂时地存储已经输出或 者将要输出的数据。

[0070] 本领域普通技术人员可以意识到，结合本文中所公开的实施例描述的各示例的单 元及算法步骤，能够以电子硬件、计算机软件或者二者的结合来实现，为了清楚地说明硬件 和软件的可互换性，在上述说明中已经按照功能一般性地描述了各示例的组成及步骤。这 些功能究竟以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专 业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不 应认为超出本公开的范围。

[0071] 所属领域的技术人员可以清楚地了解到，为了描述的方便和简洁，上述描述的电 子设备和单元的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。

[0072] 在本申请所提供的几个实施例中，应该理解到，所揭露的电子设备和方法，可以通 过其它的方式实现。例如，以上所描述的装置实施例仅仅是示意性的，例如，单元的划分，仅 仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结 合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另外，所显示或讨论的相 互之间的耦合或直接耦合或通信连接可以是通过一些接口或单元的间接耦合或通信连接， 也可以是电的，机械的或其它的形式连接。

[0073] 作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的 部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络 单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本公开实施例方案的目

说 明 书 9/10 页

CN 118116053 A

[0074] 另外，在本公开各个实施例中的各功能单元可以集成在一个处理单元中，也可以 是各个单元单独物理存在，也可以是两个或两个以上单元集成在一个单元中。上述集成的 单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。

[0075] 以上，仅为本公开的具体实施方式，但本公开的保护范围并不局限于此，任何熟悉 本技术领域的技术人员在本公开揭露的技术范围内，可轻易想到各种等效的修改或替换， 这些修改或替换都应涵盖在本公开的保护范围之内。因此，本公开的保护范围应以权利要 求的保护范围为准。

说 明 书 10/10 页

CN 118116053 A

说 明 书 附 图 1/3 页

CN 118116053 A

说 明 书 附 图 2/3 页

CN 118116053 A

说 明 书 附 图 3/3 页

CN 118116053 A