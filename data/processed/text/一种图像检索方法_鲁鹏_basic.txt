(19)中华人民共和国国家知识产权局

(12)发明专利

(10)授权公告号 (45)授权公告日

(21)申请号201310722183.3

(22)申请日2013.12.24

(65)同一申请的已公布的文献号

申请公布号CN 103678660 A

(43)申请公布日2014.03.26

(73)专利权人北京邮电大学

地址100876 北京市海淀区西土城路10号

(72)发明人鲁鹏 李睿凡 刘咏彬 袁彩霞 王小捷

(74)专利代理机构北京德琦知识产权代理有限

公司 11018 代理人郑红娟 宋志强

(51)Int.Cl.

G06F 17/30(2006.01)

(56)对比文件

CN 102763123 A,2012.10.31, CN 102422319 A,2012.04.18, CN 101140624 A,2008.03.12, WO 2013147170 A1,2013.10.03, WO 2008026414 X,2010.01.14, Xu Wangming.etc.Purifying Sets of Matched Features through RANSAC for Image Retrieval.《2010年检测技术与机电自动化国际 会议 论文集》.2011,952-955.

(54)发明名称

一种图像检索方法 (57)摘要

本发明公开了一种图像检索方法，首先计算 图像数据库中任意两个图像的内点数，根据公式

计算任意两个图

像的相关度值；然后计算查询目标与图像数据库 中任一图像的相关度值，得到与查询目标直接相 关的图像与间接相关的图像；构建一个赋权邻接 矩阵A进行衰减，且增加弥补衰减过度造成间接 相关度值过小的补给项计算查询目标vq与图像 vi的间接相关度值，并通过迭代调整所述间接相 关度值使得相关度值越高的图像与查询目标vq 的间接相关度值越大；将查询目标与图像数据库 各图像的直接相关度和间接相关度进行排序，得 到图像数据库中包含查询目标的图像。

权利要求书2页 说明书11页 附图3页

CN 103678660 B 2017.01.11

CN 103678660 B

1.一种图像检索方法，其特征在于，基于包括n个图像的图像数据库，该方法包括： A.计算图像数据库中任一图像vi与其他任一图像vj所组成的图像对的内点数cij，且i≠ j；

设置内点数门限参数θc，根据公式 计算图像数据库中图像对

vi与vj的相关度值ω(vi,vj)，其中，f(·)为cij单调递增函数；

如果ω(vi,vj)≠0，则判定图像vi与图像vj直接相关； B.应用步骤A中计算相关度值的方法计算查询目标vq与图像数据库中任一图像vi的相 关度值ω(vq,vi)；

如果ω(vq ,vi)＝0，则判定查询目标vq与图像vi间接相关，否则判定查询目标vq与图像 vi直接相关，且直接相关度值μ(vq,vi)＝ω(vq,vi)；

根据计算得到的查询目标vq与图像数据库中图像vi的相关度值ω(vq,vi)生成1×n的相 关度矩阵Wq，所述相关度矩阵Wq的列数n代表所述图像数据库的图像个数，列编号对应所述 图像数据库图像的编号，所述相关度矩阵Wq的元素ωqi＝ω(vq,vi)；

C.如果步骤B中的查询目标vq与图像vi间接相关，则构建一个赋权邻接矩阵A，在所述赋 权邻接矩阵A的基础上衰减，且增加弥补衰减过度造成间接相关度值过小的补给项计算查 询目标vq与图像vi的间接相关度值t(vq,vi)，具体地：

E1 .根据 计算得出初始间接相关度矩阵D，其中， 为Wq的转置矩阵，将D归一

E2.令间接相关度T＝D，其中，t(vq,vi)为T的元素； E3.根据T＝αB·A·T+β·D计算间接相关度T，其中αB为间接相关度衰减因子，β·D为补 给项，以弥补迭代过程中由αB导致的T值过小，D为初始间接相关度，β为补给强度控制参数；

E4.重复步骤E3，直至迭代结束； D.根据所述直接相关度值μ(vq ,vi)与间接相关度值t(vq ,vi)检索与查询目标vq相匹配 的图像，且与查询目标vq直接相关的图像的优先级高于与查询目标vq间接相关的图像。

2.根据权利要求1所述的方法，其特征在于，步骤A进一步包括： 根据步骤A中计算得到的所述图像对vi与vj的相关度值ω(vi,vj)生成n×n的相关度矩 阵W，所述相关度矩阵W的行数n与列数n分别代表所述图像数据库的图像个数，行编号与列 编号分别对应所述图像数据库图像的编号，i≠j时所述相关度矩阵W的元素ωij＝ω(vi , vj)，i＝j时所述相关度矩阵W的元素ωij＝0。

3.根据权利要求1所述的方法，其特征在于，所述赋权邻接矩阵A的元素a i j根据

计算，其中，ωij为步骤A中的所述图像数据库中图像vi与图

像vj的相关度值ω(vi,vj)。

4.根据权利要求1所述的方法，其特征在于，该方法还包括： 将所述图像数据库中的每个图像映射为一个节点，构成节点集合V0＝{v1,v2,…,vn}，其 每一个元素vi(i＝1 ,2 ,…n)表示图像数据库中的一个图像，节点编号与图像编号一一对

权 利 要 求 书 1/2 页

CN 103678660 B

如果步骤A中的ω(vi,vj)≠0，则节点vi与节点vj之间存在连接边ek，构成边集E0＝{e1, e2,…}，所述连接边的权值为ω(vi,vj)；

由节点集合V0＝{v1,v2,…,vn}与边集E0＝{e1,e2,…}生成所述图像数据库的有限、无环 的无向匹配图G0(V0,E0)。

5.根据权利要求4所述的方法，其特征在于，所述图像数据库的图像数量n达到千量级 时，生成所述图像数据库的目标集，该方法进一步包括：

F.构建目标集Vh，其初始元素为所述图像数据库中与查询目标vq直接相关的节点； G.依次查询目标集Vh各元素vhi在所述匹配图G0(V0,E0)中的直接相关节点，并将所述直 接相关节点编号添加入目标集新增节点集合Γ，根据Vh＝Vh∪Γ更新目标集Vh；

将Γ置零； H .依次查询置零前的目标集新增节点集合Γ各元素在匹配图G0(V0 ,E0)中的直接相关 节点，并将所述直接相关节点编号添加入置零后的目标集新增节点集合Γ，根据Vh＝Vh∪Γ 更新目标集Vh；

将Γ置零； I.重复步骤H，直至迭代结束，生成所述图像数据库的目标集Vh。

权 利 要 求 书 2/2 页

CN 103678660 B

一种图像检索方法

[0001] 本发明涉及图像检索技术,特别是一种图像检索方法。

[0002] 基于指定目标的图像检索任务是从大规模的图像数据库中，快速地检索出包含用 户指定目标的图像，其流程分如下两步：首先，用户提交一个包含特定目标的查询图像，并 框选出目标所在区域给检索系统；然后，检索系统从数据库中找出所有包含此目标的图像 返回给用户。对于这样的检索系统而言，速度与精度是其主要的性能指标。一个高效的检索 系统，应该在大规模数据库上具有较快的检索速度(例如，1秒/每次查询)；同时能够检索出 包含指定目标的绝大部分图像，而不论这些图像中的目标是否有遮挡、是否与查询图像具 有相同成像条件，如光照、视角等。对于这样一个检索任务，目前最有效的框架是一种基于 相似度的有效的检索框架：首先，提取特征点及区域描述符，通过聚类方法构建视觉词典。 其次，利用词典将描述符矢量化，形成图像的词袋向量表示；再次，利用向量空间模型计算 查询图像与数据库图像之间的相似度,并依据相似度对数据库图像进行粗排序；最后，利用 图像特征点的空间关系在粗排序的基础上进行重排序。

[0003] 基于相似度的图像检索方法是建立在包含同一目标的图像应该具有相近的底层 特征这一假设基础之上的。对于这样的检索系统而言，视点变化和/或光照差异是影响其性 能两个主要因素。以图1所示序列为例，随着视点角度的增加，特征点重复率低及描述符匹 配错误率高的问题会变得异常显著；此时，像图像1与图像6这样的图像对，由于底层特征上 差异过大，会被基于相似度的检索系统误判为不包含同一的目标。同样，在图2所示的光照 变化序列中，随着光照差异的增加，图像描述符匹配成功率将显著降低，也会导致像图像2 与4这样的图像对被误判。

[0004] 因此，一旦假设不成立，基于相似度的检索系统将会产生误判；系统性能也会随着 不满足假设图像的增多而急剧下降。

[0005] 有鉴于此，本发明提出了一种图像检索方法，有效降低了光照条件和/或视角变化 对图像检索的影响。本发明提出的技术方案是：

[0006] 一种图像检索方法，该方法包括：

[0007] A.计算图像数据库中任一图像vi与其他任一图像vj所组成的图像对的内点数cij， 且i≠j；

[0008] 设置内点数门限参数θc，根据公式 计算图像数据库中图

像对vi与vj的相关度值ω(vi,vj)，其中，f(·)为cij单调递增函数；

[0009] 如果ω(vi,vj)≠0，则判定图像vi与图像vj直接相关；

[0010] B.应用步骤A中计算相关度值的方法计算查询目标vq与图像数据库中任一图像vi

说 明 书 1/11 页

CN 103678660 B

的相关度值ω(vq,vi)；

[0011] 如果ω(vq,vi)＝0，则判定查询目标vq与图像vi间接相关，否则判定查询目标vq与 图像vi直接相关，且直接相关度值μ(vq,vi)＝ω(vq,vi)；

[0012] C.如果步骤B中的查询目标vq与图像vi间接相关，则构建一个赋权邻接矩阵A，在所 述赋权邻接矩阵A的基础上衰减，且增加弥补衰减过度造成间接相关度值过小的补给项计 算查询目标vq与图像vi的间接相关度值t(vq,vi)，并通过迭代调整所述间接相关度值t(vq, vi)使得步骤A中的相关度值ω(vi,vj)越高的图像与查询目标vq的间接相关度值越大；

[0013] D.根据所述直接相关度值μ(vq,vi)与间接相关度值t(vq,vi)检索与查询目标vq相 匹配的图像，且与查询目标vq直接相关的图像的优先级高于与查询目标vq间接相关的图像。

[0014] 上述方案中，步骤A进一步包括：

[0015] 根据步骤A中计算得到的所述图像对vi与vj的相关度值ω(vi,vj)生成n×n的相关 度矩阵W，所述相关度矩阵W的行数n与列数n分别代表所述图像数据库的图像个数，行编号 与列编号分别对应所述图像数据库图像的编号，i≠j时所述相关度矩阵W的元素ωij＝ω (vi,vj)，i＝j时所述相关度矩阵W的元素ωij＝0。

[0016] 上述方案中，步骤B进一步包括：

[0017] 根据步骤B中计算得到的查询目标vq与图像数据库中图像vi的相关度值ω(vq,vi) 生成1×n的相关度矩阵Wq，所述相关度矩阵Wq的列数n代表所述图像数据库的图像个数，列 编号对应所述图像数据库图像的编号，所述相关度矩阵Wq的元素ωqi＝ω(vq,vi)。

[0018] 上述方案中，所述赋权邻接矩阵A的元素aij根据 计

算，其中，ωij为步骤A中的所述图像数据库中图像vi与图像vj的相关度值ω(vi,vj)。

[0019] 上述方案中，该方法还包括：

[0020] 将所述图像数据库中的每个图像映射为一个节点，构成节点集合V0＝{v1 ,v2,… , vn}，其每一个元素vi(i＝1,2,…n)表示图像数据库中的一个图像，节点编号与图像编号一 一对应；

[0021] 如果步骤A中的ω(vi,vj)≠0，则节点vi与节点vj之间存在连接边ek，构成边集E0＝ {e1,e2,…}，所述连接边的权值为ω(vi,vj)；

[0022] 由节点集合V0＝{v1 ,v2 ,… ,vn}与边集E0＝{e1 ,e2 ,…}生成所述图像数据库的有 限、无环的无向匹配图G0(V0,E0)。

[0023] 上述方案中，所述步骤D中的间接相关度值计算方法进一步包括：

[0024] E1.根据 计算得出初始间接相关度矩阵D，其中， 为Wq的转置矩阵，将D归

[0025] E2.令间接相关度T＝D；

[0026] E3.根据T＝αB·A·T+β·D计算间接相关度T，其中αB为间接相关度衰减因子，β·D 为补给项，以弥补迭代过程中由αB导致的T值过小，D为初始间接相关度，β为补给强度控制 参数；

[0027] E4.重复步骤E3，直至迭代结束。

[0028] 上述方案中，所述图像数据库的图像数量n达到千量级时，生成所述图像数据库的

说 明 书 2/11 页

CN 103678660 B

目标集，该方法进一步包括：

[0029] F.构建目标集Vh，其初始元素为所述图像数据库中与查询目标vq直接相关的节点；

[0030] G.依次查询目标集Vh各元素vhi在所述匹配图G0(V0,E0)中的直接相关节点，并将所 述直接相关节点编号添加入目标集新增节点集合Γ，根据Vh＝Vh∪Γ更新目标集Vh；

[0031] 将Γ置零；

[0032] H.依次查询置零前的目标集新增节点集合Γ各元素在匹配图G0(V0 ,E0)中的直接 相关节点，并将所述直接相关节点编号添加入置零后的目标集新增节点集合Γ，根据Vh＝Vh ∪Γ更新目标集Vh；

[0033] 将Γ置零；

[0034] I.重复步骤H，直至迭代结束，生成所述图像数据库的目标集Vh。

[0035] 综上所述，本发明提出的技术方案能够有效降低光照和/或视角变化对图像检索 的影响，以相关关系为基础构建检索系统，有效提升了图像检索系统对于光照和/或视角变 化的鲁棒性。

[0036] 图1为不同视点角度下包含同一查询目标的图像序列。

[0037] 图2为不同光照条件下包含同一查询目标的图像序列。

[0038] 图3为方法实施例一的流程图。

[0039] 图4为图2的匹配图。

[0040] 图5为目标集生成流程图。

具体实施方式

[0041] 为使本发明的目的、技术方案和优点表达的更加清楚明白，下面结合附图及具体 实施例对本发明再作进一步详细的说明。

[0042] 本发明一个实施例的技术方案是：

[0043] A.计算图像数据库中任一图像vi与其他任一图像vj所组成的图像对的内点数cij， 且i≠j；

[0044] 设置内点数门限参数θc，根据公式 计算图像数据库中图

像对vi与vj的相关度值ω(vi,vj)，其中，f(·)为cij单调递增函数；

[0045] 如果ω(vi,vj)≠0，则判定图像vi与图像vj直接相关；

[0046] B.应用步骤A中计算相关度值的方法计算查询目标vq与图像数据库中任一图像vi 的相关度值ω(vq,vi)；

[0047] 如果ω(vq,vi)＝0，则判定查询目标vq与图像vi间接相关，否则判定查询目标vq与 图像vi直接相关，且直接相关度值μ(vq,vi)＝ω(vq,vi)；

[0048] C.如果步骤B中的查询目标vq与图像vi间接相关，则构建一个赋权邻接矩阵A，在所 述赋权邻接矩阵A的基础上衰减，且增加弥补衰减过度造成间接相关度值过小的补给项计 算查询目标vq与图像vi的间接相关度值t(vq,vi)，并通过迭代调整所述间接相关度值t(vq, vi)使得步骤A中的相关度值ω(vi,vj)越高的图像与查询目标vq的间接相关度值越大；

说 明 书 3/11 页

CN 103678660 B

[0049] D.根据所述直接相关度值μ(vq,vi)与间接相关度值t(vq,vi)检索与查询目标vq相 匹配的图像，且与查询目标vq直接相关的图像的优先级高于与查询目标vq间接相关的图像。

[0050] 基于相似度的图像检索系统中常用图像对的词袋向量余弦夹角和估计它们之间 变化矩阵时得到的内点数来度量图像的相似度。前者用于粗检索阶段的排序，后者则更多 用于粗排序后的重排序，因此内点数相对于余弦夹角的度量更为严格，所以，本发明通过内 点数得到图像对vi与vj的相关度值ω(vi,vj)，其计算公式为：

[0051]

[0052] 这里f(cij)为cij的单调递增函数，cij为图像对vi与vj的内点数，θc为内点数门限参 数(θc为常数，用户自定义)，用来克服误匹配带来的影响，有效控制图像之间的匹配关系。 图像对vi与vj的相关度值ω(vi ,vj)≠0才认为这两个图像直接相关。相应的图像数据库对 应的相关度矩阵W表示为：

[0053]

[0054] 假设图像数据库中有n个图像，任意两个图像vi与vj都可以计算得到两者之间的相 关度值，根据相关度值可以进一步得出图像数据库的有限、无环的无向匹配图G0(V0,E0)。图 像数据库中的每个图像映射为匹配图G0(V0,E0)中的一个节点，表示为

[0055] V0＝{v1,v2,…,vn} (3)

[0056] 其每一个元素vi(i＝1 ,2,…n)表示图像数据库中的一个图像，节点编号与图像编 号一一对应；边集E0(G0)＝{e1,e2,…,em}的每一个元素ek＝(vi,vj)，表示无序节点对vi与vj 之间存在连接边；边ek的权值用vi与vj的相关度值ω(vi,vj)表示，ω(vi,vj)＝0的两个图像 对vi与vj之间没有连接边。

[0057] 数据库的任意图像对的相关度值以及图像数据库的匹配图生成以后，就可以计算 查询目标vq与图像数据库各图像的直接相关度值与间接相关度值了。首先计算查询目标vq 与图像数据库各图像的相关度值，在此基础上进一步计算查询目标vq与图像数据库各图像 的直接相关度值与间接相关度值。其中，查询目标vq与图像数据库各图像的相关度值的计 算方法与前面介绍的图像数据库任意两个图像对vi与vj的相关度值计算方法相同，在此不 再详述，计算得到的相关度值用矩阵Wq表示：

[0058] Wq＝[ωq1 ωq2 … ωqi … ωqn] (4)

[0059] 其中，ωqi＝ω(vi,vq)，表示查询目标vq与图像数据库某图像vi的相关度值，n为图 像数据库图像的个数，如果ω(vq,vi)＝0，则查询目标vq与图像vi间接相关，否则查询目标vq 与图像vi直接相关，且直接相关度值μ(vq,vi)＝ω(vq,vi)。

[0060] 查询目标vq与图像数据库各图像的相关度值计算完毕后，会得到一个矩阵集合Vd ＝{vd1 ,vd2,…,vdl}，其元素vdi为与查询目标vq直接相关的节点。图像数据库的节点集合V0

说 明 书 4/11 页

CN 103678660 B

与Vd的差值就是与查询目标vq间接相关的图像集合Vp＝{vp1,vp2,…,vps}，查询目标vq与vpi 之间的匹配程度用间接相关度值表示，这里vpi为与查询目标vq间接相关的图像集合Vp的元 素，间接相关度值的计算方法基于两个假设：

[0061] 假设1：到vi的基本路径长度越长的节点，与查询目标vq的间接相关度值越小。

[0062] 假设2：与vi相邻的节点中连接边的权值越高的节点，与查询目标vq的间接相关度 值越大。

[0063] 这里vi为图像数据库中的任意一个图像。为了满足假设约束，针对假设1引入间接 相关度衰减因子αB，其控制间接相关度从当前节点vi流向与其直接相关节点时间接相关度 的衰减程度；针对假设2引入了赋权邻接矩阵A，其保证与vi相邻的节点中连接边的权值越 高的节点获得的间接相关度越多。

[0064] 上述假设给间接相关度传递算法定义了一个较粗的原则，因此，可以自由发挥来 设计传播算法。可以采用如下方法进行计算：

[0065] 首先，计算匹配图赋权邻接矩阵A。

[0066] 赋权邻接矩阵A的元素aij根据公式

[0067]

[0068] 其中ωij为图像数据库的相关度矩阵W的元素。

[0069] 其次，生成初始间接相关度矩阵D。

[0070] 初始间接相关度矩阵D根据公式

[0071]

[0072] 计算得出，即：

[0073]

[0074] 为了便于计算，将D归一化，归一化后的矩阵D即为初始间接相关度矩阵。

[0075] 最后，迭代计算间接相关度：

[0076] 间接相关度的计算是一个迭代过程，初次迭代时，令间接相关度T＝D，即：

[0077]

[0078] 然后根据公式

说 明 书 5/11 页

CN 103678660 B

[0079] T＝αB·A·T+β·D (9)

[0080] 计算间接相关度T，其中αB为针对假设1引入的间接相关度衰减因子，其控制间接 相关度从当前节点vi流向与其直接相关节点时间接相关度的衰减程度，A为针对假设2引入 的赋权邻接矩阵，其保证直接相关度越高的节点获得的间接相关度越多，β·D为补给项，以 弥补迭代过程中由αB导致的T值过小，其中，D为初始间接相关度，β为补给强度控制参数，在 实际使用中可以设置，β＝1-αB。迭代次数由用户根据数据库图像规模自定义，最终计算得 出图像数据库各图像与查询目标的间接相关度T。

[0081] 根据间接相关度将Vp中与查询目标间接相关的图像将其由高到低进行排列，根据 需要向用户返回查询结果，且Vd中的图像与查询目标的匹配程度比Vp中图像与查询目标的 匹配程度优先级高。

[0082] 以上则是本发明的图像检索方法，当数据库图像数量n达到千量级时，利用上述间 接相关度计算方法进行图像数据库各图像与查询目标的间接相关度时需要较长的运算时 间，且还需要消耗较多的内存空间，因此可以生成一个原始图像数据库的目标集，使得目标 集具有以下三个属性：

[0083] 1.目标集相对原始图像数据库规模较小。

[0084] 2.目标集元素与查询目标高度相关。

[0085] 3.目标集包含大多数(或者许多)与查询目标相关的节点。

[0086] 这样的目标集能够极大地节约计算量与内存消耗，且具有较高的召回率，能够极 大地保证间接相关度计算方法的有效性，具体目标集的生成方法如下：

[0087] A.构建目标集Vh，其初始元素为所述图像数据库中与查询目标vq直接相关的节点， 即Vd中的元素；

[0088] B.依次查询目标集Vh各元素vhi在所述匹配图G0(V0,E0)中的直接相关节点，并将所 述直接相关节点编号添加入目标集新增节点集合Γ，根据Vh＝Vh∪Γ更新目标集Vh；

[0089] 将Γ置零；

[0090] C.依次查询步骤B中置零前的目标集新增节点集合Γ各元素在匹配图G0(V0,E0)中 的直接相关节点，并将所述直接相关节点编号添加入置零后的目标集新增节点集合Γ，根 据Vh＝Vh∪Γ更新目标集Vh；

[0091] 将Γ置零；

[0092] D.重复步骤C，直至迭代结束，生成所述图像数据库的目标集Vh。

[0093] 结合图像数据库的规模以及图像检索的要求，设计一个迭代次数，通过迭代查询 目标集Vh新增节点的直接相关节点来不断更新目标集Vh，最终得到一个图像数量相对图像 数据库较小的目标集，该目标集中包含了绝大多数(或者许多)与查询目标高度相关的节 点。

[0094] 得到目标集Vh后，就可以将大规模的图像检索数据库转化为较小规模的图像检索 数据库，按照前述利用相关度进行图像检索的方法，实现从大规模图像数据库中查询目标 图像，并且不受光照和/或视角变化的影响，提高了图像检索系统的性能。

[0095] 方法实施例一

[0096] 本实施例以图像数据库规模较小的情况为例，图1中的六个图像成像的视点角度 不同，将这六个图像作为一个小型图像数据库，以图1中编号为1的图像中的房屋模型作为

说 明 书 6/11 页

CN 103678660 B

图像查询目标vq，检索图1所示数据库中含有查询目标vq的图像，图3为本实施例的流程图， 包括以下步骤：

[0097] 步骤301：计算图像数据库中任意两个图像对的内点数。

[0098] 计算图像数据库中任意两个图像对vi与vj的内点数cij的方法为：提取DOG尺度不 变点及128维SIFT描述符，然后利用最优节点优先(BBF，Best Bin First)算法获取图像间 的匹配点对，采用随机抽样一致(RANSAC，Random Sample Consensus)方法来估算仿射变换 矩阵，从而获得内点数。内点数的计算方法为本领域现有技术，在此不作详细描述。对于图1 中任意两个图像的内点数计算结果如表1所示：

[0099] 表1

[0100]

[0101] 步骤302：计算图像数据库中任意两个图像对的相关度值。

[0102] 设置内点数门限参数θc(θc为常数，用户自定义)来克服误匹配带来的影响，有效控 制图像之间的匹配关系。根据公式(1)计算vi与vj的相关度值。并定义：

[0103] f(cij)＝cij (10)

[0104] θc＝12 (11)

[0105] 根据公式可得任意两个图像对的相关度值，如表2所示，相应的图像数据库对应的 相关度矩阵W表示为：

[0106] 表2

[0107]

说 明 书 7/11 页

CN 103678660 B

[0108]

[0109] 步骤303：相关度值计算结束后生成匹配图。

[0110] 图像数据库中有6个图像，图像编号依次为1～6，每个图像映射为有限、无环的无 向匹配图G0(V0,E0)中的一个节点，每个节点表示图像数据库中的一个图像，节点编号与图 像编号一一对应；边集E0(G0)＝{e1,e2,…,e9}的每一个元素ek＝(vi,vj)，表示无序节点对vi 与vj之间存在连接边；边ek的权值用vi与vj的相关度值ω(vi,vj)表示，ω(vi,vj)＝0的两个 图像对vi与vj之间没有连接边。由此得到的匹配图如图4所示。图4中，节点1和节点5之间没 有连接边，但是节点1与节点5之间存在路径(例如节点1经节点3能够到达节点5)，这种存在 路径但是不存在连接边的节点对称为间接相关。

[0111] 从图4中可以看到，图像数据库生成的匹配图均非完全图，这也就是说包含同一目 标的图像之间并非都直接相关也可能间接相关。间接相关性的产生源于包含同一目标的图 像在语义层面上的一致性，因此，它能一定程度反映图像在语义层面的一致性；而直接相关 性则主要从底层特征层面反映图像的相似性。因此，如果能够同时考虑直接相关与间接相 关关系，检索系统将能在保持现有检索性能的前提下，有效地克服光照和/或视点变化带来 的影响。

[0112] 步骤304：检索图像数据库中与查询目标直接相关的图像。

[0113] 本步骤中，依次计算数据库中每幅图像与查询目标vq的内点数，进而根据公式(1) 计算查询目标vq与图像数据库中每幅图像的相关度，相关度不为0的即为与查询目标vq直接 相关的图像。计算得出的内点数如表3所示：

[0114] 表3

[0115]

图像对 vq-1 vq-2 vq-3 vq-4 vq-5 vq-6 内点数 119 53 14 11 6 7

[0116] 计算得到查询目标与图像数据库中每幅图像的相关度，计算方法同前述图像数据 库中任意两个图像计算相关度，在此不再赘述，计算结果如表4所示：

[0117] 表4

[0118]

图像对 vq-1 vq-2 vq-3 vq-4 vq-5 vq-6 相关度值 119 53 14 0 0 0

[0119] 根据表4可以看出，与查询目标vq直接相关的图像为图像1、图像2和图像3，定义一 个集合Vd＝{1 ,2,3},Vd为与查询目标vq具有直接相关关系的节点集合。查询目标vq与图像 数据库各节点之间的相关度矩阵Wq为：

[0120] Wq＝[119 53 14 0 0 0] (13)

[0121] 步骤305：检索图像数据库中与查询目标间接相关的图像。

说 明 书 8/11 页

CN 103678660 B

[0122] 首先，计算匹配图赋权邻接矩阵A。

[0123] 赋权邻接矩阵A的元素aij根据公式(5)计算得到：

[0124]

[0125] 其次，生成初始间接相关度矩阵D。

[0126] 初始间接相关度矩阵D为：

[0127]

[0128] 根据D＝D/|D|归一化矩阵D：

[0129]

[0130] 归一化后的矩阵D即为初始间接相关度矩阵。

[0131] 最后，迭代计算间接相关度：

[0132] 间接相关度的计算是一个迭代过程，初次迭代时，令间接相关度T＝D，即：

[0133]

[0134] 然后根据公式T＝αB·A·T+β·D计算间接相关度T，其中取β＝1-αB，αB为针对假设 1引入的间接相关度衰减因子，其控制间接相关度从当前节点vi流向其直接相关节点时间 接相关度的衰减程度，A为针对假设2引入的赋权邻接矩阵，其保证相关度值越高的节点获 得的间接相关度越多，β·D为补给项，以弥补迭代过程中由αB导致的T值过小，其中，D为初 始间接相关度，β为补给强度控制参数，本实施例中设置，β＝1-αB。迭代次数由用户根据数 据库图像规模自定义，最终计算得出的间接相关度T为

说 明 书 9/11 页

CN 103678660 B

[0135]

[0136] 根据间接相关度排列图像数据库中与查询目标间接相关的图像，即图像4、5、6，相 应的间接相关度分别为0.075、0.037、0.01，与查询目标相关程度由高到低依次为4、5、6，综 合与查询目标直接相关的图像，图像数据库中与查询目标相关度由高到低排列依次是图像 1、2、3、4、5、6。

[0137] 若间接相关度T中某个元素为0，则说明相应的图像不包含查询目标房屋模型。

[0138] 本实施例从图像数据库规模较小的角度，以不同视点角度条件下的图像为例，对 本发明技术方案进行了说明。同样，不同光照条件下的图像也可以应用本发明技术方案进 行图像检索，提升底层特征对光照变化的鲁棒性，在此不再详述。

[0139] 应用本发明技术方案，以直接相关度和间接相关度作为判断图像是否匹配的判断 依据，不仅可以提升底层特征对视角变化的鲁棒性，同样可以提高对光照变化的鲁棒性，这 是由于本发明技术方案摒弃了包含同一目标的图像应该具有相近的底层特征这一假设基 础，在特征层面上重新定义同一目标图像之间的相关关系，以相关关系为基础来构建检索 系统，使得基于相关的图像检索技术能够更大程度的检索出包含同一查询目标的图像。

[0140] 方法实施例二

[0141] 方法实施例一从数据库规模较小的角度对本发明技术方案进行了说明，本实施例 则从数据库规模较大的角度作进一步说明。

[0142] 图像表示方面，采用Hessian-Affine方法(该方法为现有技术，在此不再详述)提 取尺度不变特征点及仿射不变区域，并将得到的仿射不变区域转换成128维SIFT描述符。然 后采用近似K-Means聚类方法(该方法为现有技术，在此不再详述)对数据库的全部SIFT描 述符进行聚类以产生视觉词典；最后，利用视觉词典对图像描述符进行矢量化，每幅图像由 一个稀疏的向量来表示，向量的每一维对应于视觉词典中的一个单词，其取值表示该词在 当前图像中出现的频率。

[0143] 相似度计算方面，图像检索系统采用标准的TF-IDF(Term Frequency–Inverse Document Frequency)方法(该方法为现有技术，在此不再详述)计算每个视觉单词的特征 权重，同时采用余弦夹角进行图像相似度计算。为了有效地存储图像表示数据，加快图像间 相似度计算，图像检索系统采用了倒排索引技术。

[0144] 空间验证方面，图像检索系统采用随机抽样一致( RANSAC，Random Sample Consensus)的方法估计两幅图像间的仿射变换参数及相应的内点数。在匹配图生成时，选 择TF-IDF得分靠前1000幅图像进行内点数计算。在实时图像检索时，选择TF-IDF得分靠前 200幅图像进行内点数计算。

[0145] 利用图像检索系统，将数据库每个图像做一次查询，即可以离线构建数据库图像 的匹配图G0。当用户提交包含查询目标的查询请求后，利用图像检索系统计算查询目标与 数据库图像的内点数，然后，基于f(cij)与θc即可以获得查询目标vq与数据库中节点的连接

说 明 书 10/11 页

CN 103678660 B

边集Eq及边上的权值。

[0146] 在实际系统中，为了归一化匹配图边上的权值，也可以定义f(·)为sigmoid函数， 即:

[0147]

[0148] 间接相关度传递算法是一个在线算法，其对运算量及内存消耗都取决于匹配图。 当数据库图像数量n达到千量级时，例如n>5000，算法不仅需要较长的运算时间，同时还需 要消耗较多的内存空间。对于用户每次查询请求q，可以找寻图G0的一个导出子图H(Vh,Eh)， 使节点集合Vh能够具有以下三个属性：

[0149] 1.规模相对较小

[0150] 2.节点元素与查询目标高度相关

[0151] 3.包含绝大多数(或者许多)与查询目标相关的节点。

[0152] 满足条件1将极大地节约计算量与内存消耗；满足2、3说明Vh集合具有较高的召回 率，所以能极大地保证传递算法的有效性。图5为子图生成流程图，如图5所示，包括以下步 骤：

[0153] 步骤501：构建目标集，其初始元素为与查询目标直接相关的节点。

[0154] 本步骤中，构建目标集Vh，所述目标集中存放的是子图的节点集合，其初始值为与 查询目标vq直接相关的节点，即Vd中的元素。

[0155] 步骤502：查询目标集各图像节点在匹配图中直接相关的节点，并将所述直接相关 节点的编号添加入目标集新增节点集合中，更新目标集。

[0156] 本步骤中，依次查询目标集Vh各图像节点在匹配图G0(V0 ,E0)中的直接相关节点， 并将其节点编号添加入目标集新增节点集合Γ，根据Vh＝Vh∪Γ更新目标集Vh：

[0157] 其中Γ为目标集Vh的元素vhi的直接相关节点集合，每次通过公式Vh＝Vh∪Γ更新 目标集Vh后，将Γ置零；

[0158] 步骤503：查询步骤502中置零前的目标集新增节点集合Γ各图像节点在匹配图中 的直接相关节点，并将所述直接相关节点的编号添加入置零后的目标集新增节点集合Γ， 进一步更新目标集。

[0159] 本步骤中，查询步骤502中置零前的目标集新增节点集合Γ各图像节点在匹配图 G0(V0,E0)中的直接相关节点，并将所述直接相关节点的编号添加入置零后的目标集新增节 点集合Γ，由公式Vh＝Vh∪Γ更新目标集Vh，将Γ置零。

[0160] 步骤504：设置迭代次数，重复步骤503。

[0161] 结合图像数据库的规模以及图像检索的要求，设计迭代次数，重复步骤503，通过 对与查询目标vq直接相关的节点的层层外拓，得到一个图像数量相对图像数据库较小的目 标集，该目标集中包含了绝大多数(或者许多)与查询目标高度相关的节点。

[0162] 根据步骤504中得到的目标集，获得图G的一个导出子图H(Vh,Eh)。

[0163] 由Vh生成匹配图的导出子图H；然后，利用H的赋权连接矩阵代替匹配图G的赋权连 接矩阵计算间接相关度，就可以提升计算速度同时降低存储开销。

[0164] 以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精 神和原则之内所做的任何修改、等同替换、改进等，均应包含在本发明保护的范围之内。

说 明 书 11/11 页

CN 103678660 B

说 明 书 附 图 1/3 页

CN 103678660 B

说 明 书 附 图 2/3 页

CN 103678660 B

说 明 书 附 图 3/3 页

CN 103678660 B