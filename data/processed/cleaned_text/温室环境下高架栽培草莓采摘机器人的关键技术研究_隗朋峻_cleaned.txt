---

关键技术研究

 Wei Pengjun

电子信息（控制工程）

模式识别与智能控制

导师：刘仁学

校外导师：李睿凡

North China University of Technology

2023年5月28日

Key Technology Research on Strawberry Picking Robot in Greenhouse Environment under Elevated Cultivation

Abstract

In the past decade, China has become the world's largest producer and consumer of strawberries. The existing manual-based planting and management modes, constrained by rising labor costs, are limiting the development of the strawberry industry. Automation of strawberry picking can significantly reduce labor requirements and enhance the industry's sustainability. This paper focuses on key technologies for the identification and localization of strawberry fruits in a greenhouse environment, including target recognition and segmentation, ripeness and occlusion judgment, and pose estimation for picking points.

1. Target Recognition and Localization System: A strawberry target recognition and fine segmentation technology based on image target prepositioning, convolutional neural network, and U-net network is proposed for high-accuracy localization and point cloud segmentation.

2. Ripeness and Occlusion Judgment: Using convex hull features and support vector classifiers to assess草莓目标的成熟性和遮挡性.

3. Pose Estimation and Picking Point Estimation: Utilizing the geometric characteristics of the target point cloud and the strawberry surface point cloud for precise estimation.

Keywords: Strawberry picking, fruit occlusion, point cloud segmentation, pose estimation, target localization

Chapter 1 Introduction...............................................................................................1
1.1 Background and Significance...............................................................................1
1.2 Research Status of Strawberry Picking Robot Technology at Home and Abroad......................................1
1.2.1 Strawberry Target Identification.....................................................................2
1.2.2 Strawberry Target Localization......................................................................4
1.3 Main Research Contents and Chapter Structure......................................................5
1.3.1 Main Research Content................................................................................5
1.3.2 Chapter Structure........................................................................................6
1.4 Summary...........................................................................................................7

Chapter 2 Theories Related to Target Identification and Localization..........................................8
2.1 Target Identification and Segmentation Algorithm Theory..............................................8
2.2 Algorithm Theories for Strawberry Harvestability Discrimination...................................12
2.3 Target Localization and Point Cloud Processing Algorithm Theory...................................16
2.4 Basic Theories of Picking Action Generation System...................................................22
2.5 Summary...........................................................................................................28

Chapter 3 Overall Scheme Design of Strawberry Automatic Picking System for Elevated Cultivation...29
3.1 Demand Analysis of Strawberry Automatic Picking System...........................................29
3.2 Scheme Design for Strawberry Pose Estimation and Picking Point Localization in Natural Environment........................................................................................................29
3.3 Summary...........................................................................................................32

Chapter 4 Design of Strawberry Image Identification and Regional Segmentation Methods..............33
4.1 Strawberry Target Pre-localization Module Based on Target Color and Saturation..............33
4.2 Strawberry Target Identification Module Based on Convolutional Neural Network..............34
4.3 Strawberry Target Fine Localization Module Based on U-net Network...........................39
4.4 Test Analysis of Target Area and Point Cloud Segmentation System..............................45
4.5 Summary...........................................................................................................46

Chapter 5 Design of Strawberry Fruit Spatial Pose and Picking Point Identification Methods........47
5.1 Strawberry Fruit Spatial Pose Estimation and Picking Point Localization System..............47
5.2 Software Design for Action Generation System........................................................53

---

第二章目标识别与定位方法相关理论

2.1 目标识别与分割算法理论

目标识别和目标分割是计算机视觉领域中两个重要的任务，它们可以帮助计算机自动地理解和分析图像或视频中的目标，从而实现智能化的应用。

随着计算机视觉技术的不断发展，目标识别技术也在不断的改进和完善。传统的目标识别算法主要是基于目标有限特征分析，适用于简单的目标识别任务。基于卷积神经网络(CNN)的目标识别模型通过对目标图像数据集的训练学习，获得目标的深层特征，使基于卷积神经网络的识别算法能够在复杂的非结构化环境中更加稳定准确地识别目标。在应对复杂环境情况下的目标识别任务时，相比于传统的目标识别算法，基于CNN的目标识别算法具有更高的鲁棒性。

2.1.1 图像的色彩空间分析

图像的色彩空间是用于描述图像颜色属性的一组坐标系。常见的色彩空间包括RGB、CMYK、HSV等。目前大多数数字图像均使用RGB色彩空间，由红色、绿色和蓝色三个颜色通道组成。本文所获取到的草莓原始图像颜色空间也为RGB模式，所拍摄的温室环境草莓种植场景图像如图2-1所示。

图2-1 自然环境下草莓的RGB图像

图2-1为自然环境下的草莓图像，图中包含成熟草莓，半成熟草莓和未成熟草莓。由于成熟草莓的生物特点，其颜色大多为红色，成熟草莓目标区域的R通道值较高。但是，自然场景中除了成熟草莓，还有部分枯萎的枝叶、强光照等区域的R通道值也明显较高。因此，在RGB颜色空间中无法找到一个显著的数值区间将成熟草莓成功分割。

若要解决草莓目标与背景颜色差异不显著的问题，这里引入HSV色彩空间。HSV是一种常用的颜色模型，由A.R.Smith在1978年提出。其中H代表色调(Hue),S代表饱和度(Saturation),V代表明度(Value)。相对于RGB颜色模型，HSV颜色模型更符合人类视觉对颜色的感知，其与RGB颜色模型之间的转化关系为：

H = 60° * ((max(R,G,B) - min(R,G,B)) / (max(R,G,B) - min(R,G,B))) + 120° * ((max(R,G,B) - min(R,G,B)) / (max(R,G,B) - min(R,G,B))) + 240° * ((max(R,G,B) - min(R,G,B)) / (max(R,G,B) - min(R,G,B)))

S = (max(R,G,B) - min(R,G,B)) / max(R,G,B)

V = max(R,G,B)

式中：H、S、V为色相、饱和度、明度；R、G、B为红、绿、蓝三通道数值；max(R,G,B)与min(R,G,B)为图像同一像素点RGB三通道中最大值和最小值。

将图2-1转换到HSV颜色空间后，其H、S、V通道灰度图像如图2-2所示。

图2-2 自然环境下草莓图像HSV三通道灰度图

图2-2(a)、2-2(b)、2-2(c)为图2-1转换到HSV颜色空间后H通道、S通道、V通道灰度图。根据图2-2可直观的观察到，相比于图2-2(a)和图2-2(c)成熟草莓于背景区域并无显著差异，图2-2(b)中成熟草莓的饱和度较高，在S通道灰度图像上，成熟草莓区域的灰度值明显高于背景同时轮廓较为清晰。因此，在S通道上做阈值分割处理有利于完成对成熟草莓的预定位处理。

卷积神经网络(Convolutional Neural Network,CNN)是一种广泛应用于图像处理和计算机视觉等领域的深度学习模型，其可以很好的完成图像分类或物体识别等任务。卷积神经网络主要由输入层、卷积层、激活层、池化层、批归一化层、随机失活层以及全连接层构成。

图像输入层会接收到数据输入，通常是图像或者其他形式的数据。在输入到卷积神经网络之前，通常需要对原始图像数据进行一些预处理操作，例如将像素值进行归一化、对图像进行裁剪或缩放等。在卷积神经网络中，图像数据通常被表示为张量的形式。

卷积层是卷积神经网络的核心。在卷积层中，输入数据和多个卷积核进行卷积运算，以提取输入数据的特征。卷积运算可以看作是一个滑动窗口在输入数据上滑动并取得各个位置上的局部区域与卷积核进行乘积和求和的过程。其运算过程如图2-3所示。

图2-3 卷积运算示意图

如图2-3所示，输入一个3x3的图像，使用2x2的卷积核，步长为1，通过图2-3(a)、(b)、(c)、(d)对其进行滑动卷积运算，得到原始图像的特征输出。

激活层是对卷积层输出进行非线性变换的层。在卷积神经网络中，每个卷积层后面通常都会紧跟一个激活层。激活层的输入是卷积层的输出，它对每个元素进行非线性的变换，并输出给下一层。常见的激活函数包括ReLU、Sigmoid、tanh等，通过激活函数的非线性变换，可以使神经网络具有更强的表达能力。

池化层的主要作用是对输入数据进行下采样，从而减少特征图的尺寸，并且可以减少网络的参数量，防止过拟合。池化层将输入特征图划分为不重叠的小块，然后对每个小块进行操作，通常选择最大值(Max Pooling)或平均值(Average Pooling),生成一个新的、尺寸更小的特征图。这个新的特征图通常保留了输入特征图中的主要特征，同时减少了数据的维度和参数量，使得网络更加高效。最大值池化层(Max Pooling)通常能够保留输入特征图中的主要特征，而平均值池化层(Average Pooling)则可以平滑噪声，减少过拟合。

批归一化层可以加速神经网络的训练收敛，提高模型的泛化能力，通过对每个小批量输入数据进行归一化处理，使得网络更易于训练和调整。同时，由于批归一化层可以减少网络对特定批次输入数据的依赖，因此可以提高网络的泛化能力，减少过拟合的风险。

随机失活层是一种正则化技术，旨在减少过拟合的风险。在训练过程中随机选择一些神经元并将它们的输出设为0，从而使得网络不依赖于任何一个单独的神经元来进行预测，而是依赖于多个神经元的组合，增加了网络的泛化能力。

全连接层通常是网络的最后一层，它将前面的卷积层、池化层、激活层等的输出特征进行展开并转化为一个一维向量，该向量包含了输入图像中的各种特征，如纹理、形状和颜色等，它们将被用于下一步的分类或回归任务。全连接层中的每个神经元都与前一层中的所有神经元相连，因此它们需要学习大量的权重和偏置参数，以便对输入特征进行有效的组合和转换。这些参数的学习通常是通过反向传播算法来实现的，从而优化损失函数并使网络的预测结果更加准确。

全卷积神经网络(Fully Convolutional Neural Network,FCN)区别于卷积神经网络的一点是，FCN完全由卷积层和反卷积层组成，没有全连接层。FCN在最后一层使用反卷积层(上采样)代替了全连接层，从而将原始图像的每一个像素都映射到输出结果中，将特征图像信息还原为与原图大小一样的语义分割图像。因此，使用全卷积神经网络更有利于精确的找到自然环境下草莓目标所属的像素。

反卷积的过程可以看作是对卷积操作的逆向操作。在卷积操作中，图像经过卷积核的卷积操作得到下采样的特征图。而在反卷积中，特征图被上采样，再经过反卷积核的反卷积操作，从而得到更高分辨率的图像。图像反卷积的运算过程如图2-4所示。

图2-4 反卷积运算示意图

U型全卷积神经网络(Unet)在全卷积神经网络的基础上引入了跳跃连接，将编码器中的特征图与解码器中的特征图进行连接，从而使网络能够同时利用浅层次和深层次的信息，提高了网络对于物体边缘细节的识别能力。与FCN相比，Unet可以更好的保留特征图中的细节信息。其网络结构如图2-5所示。

图2-5 Unet网络结构示意图

如图2-5所示，Unet网络结构呈U型对称。左半部分结构为图像的编码器部分，编码器将输入的原始图像通过多个卷积层和池化层进行特征提取和抽象，将图像中的低级特征转化为高级特征，使得模型能够更好地理解图像的语义信息。其中卷积层用于提取特征，而池化层则用于对特征进行下采样，将特征图的尺寸缩小一半，从而使得模型能够更好地处理大尺寸的图像。右半部分结构为图像的解码器部分，解码器将编码器部分生成的特征图通过多个反卷积层和卷积层进行上采样和合并，以生成最终的分割结果。其中反卷积层用于对特征图进行上采样，将特征图的尺寸放大一倍，而卷积层则用于进一步提取和融合特征信息。

草莓的质量和产量与草莓的成熟度息息相关。由于果实的种植轮次和收获周期等原因，同一张图象中的所有草莓并非都可以采摘。如果草莓未成熟就被采摘下来，不仅草莓本身质量不佳，而且还会对植株生长和产量产生不良影响。因此，为了准确的识别所有草莓，并获取其中可以采摘的草莓。本文基于草莓目标区域的凸包属性，使用统计阈值和SVM分类器实现了草莓果实的成熟性判别和遮挡类型判别，为后续的点云处理方法提供指引。

图像目标区域凸包是指将目标区域中的所有点连接起来所形成的最小凸多边形。计算目标区域凸包的方法有多种，其中比较常用的是Graham扫描法。

Graham扫描法是一种基于极角排序的凸包计算方法，设目标区域的边缘点集为{(x1,y1),(x2,y2)...(xn,yn)}，其基本实现步骤如下：

1)找到图像中的最低点P0，也就是点集P中y值最小的点，若有多个y值相等且最小，则选择其对应的x值最小的点作为P0。

2)对于P中的其他点Pi，计算Pi与P0的极角并按照极角从小到大的顺序对Pi进行排序。若有多个点极角相同，则按照距离P0的距离从小到大排序。

3)创建一个栈，初始时将P0和排序后的第二个点P1入栈。对于排序后的每个点Pi，判断Pi是否在栈顶前一个元素T2和栈顶元素T1连线形成射线的左边。如果是，则将Pi入栈；否则，弹出栈顶元素T1，直到Pi在T2T1连线的左边。依次进行如上操作直至最后一个Pi点，最终栈内的点即为凸包的点集。

将上述过程动态展示，如图2-5所示。

图2-5 Graham法计算凸包算法动态展示

图2-5(a)-(e)中的坐标系为以P0为原点建立的xPy坐标系，逆时针旋转分别为按照极角从小到大的顺序对Pi。图2.5(a)中，先将最低点P0和排序后的第二个点P1存入栈中，由于极角最大的点也一定在凸包上，所以将P5与P0的红色连线也一并在图中绘制。图2-5(b)中，点P2在射线P1P0的左边，因此将P2压入栈中，此时P2为栈顶元素。图2-5(c)中，点P3在射线P2P1的右边，说明P2在P1P3的内部，P2不是凸包上的点，因此将P2从栈中弹出。图2-5(d)中，P3入栈。依此类推，P4、P5均符合算法规则，依次入栈。图2-5(f)中，找到目标点集的完整凸包。

支持向量机(Support Vector Machine,SVM)是一种常用的机器学习算法，主要用于二分类问题。其基本思想是在特征空间中找到一个能够最大化不同类别之间间隔(Margin)的超平面，从而将不同类别的数据分开。

其公式推导如下所示，给定训练样本集：

{(x1,y1),(x2,y2),...,(xl,yl)}，其中xi∈RN，为N维向量；对于二分类问题yi∈{-1,1}；通过学习训练寻求分类器M(x)，使其不但对于训练样本集满足yi=M(xi)，而且对于预测数据

同样能得到对应输出值yi。线性划分的理想情况是训练样本集可以完全线性分离。当训练样本集不能线性分离时，可以通过引入松弛变量而转化为可线性分离的情况。对于式(2-4)给出的训练样本集的线性二分类问题，就是寻求函数：

f(x) = Sgn(w·x+b)

使对于i=1,2,...,l满足条件：

yi=f(xi)

其中w、b∈R为待确定的参数，Sgn为符号函数。显然w·x+b=0为划分超平面，w为其法向量。式(2-7)又可写成等价形式：

yi(w·xi+b)≥1

对于线性可分离的问题，满足上述条件形如式(2-6)的线性决策函数是不唯一的。图2-6(a)给出二维情况下满足条件的划分直线的分布区域图。落在中间区域内的任意直线都可作为决策函数。

图2-6 SVM二分类问题数据示意图

Vapnik提出一个最大边际化(maximal-margin)原则，所谓边际又称间隔，是指训练样本集到划分超平面的距离，它是所有训练样本点到划分超平面的(垂直)距离中的最小：

Min(w) = (1/||w||) * Min(1,2,...,l) {xi·w+b}

所谓最大边际化原则是指寻求使间隔达到最大的划分为最优，即是对w,寻求最优，求得最大间隔：

Max(Min(w)) = (1/||w||) * Max(Min(1,2,...,l) {xi·w+b})

对应最大间隔的划分超平面称为最优划分超平面，简称为最优超平面，如图2-6(b)中的L。图2-6(b)中两条平行虚线1L、2L(称为边界)距离之半就是最大间隔。

可以证明最大间隔是唯一的，但达到最大间隔的最优超平面可能不唯一。

最大间隔和最优超平面只由落在边界上的样本点完全确定，我们称这样的样本点为支持向量，如图2.6(b)中的1x、2x、3x样本点。

只由少数训练样本点(支持向量)就把最大间隔和最优超平面完全确定，其余非支持向量的样本点均不起作用，说明间隔最大化原则下的最优划分不是依赖于所有点，而只是由支持向量决定。求最优超平面和最大间隔等同于确定各个样本点是否支持向量，说明该方法具有好的鲁棒性和好的算法复杂性。

由支持向量确定的线性分类机称为线性支持向量机。

对于式(2-4)给定的训练样本集，如果样本是线性可分的，则图2.6(b)中的划分超平面L的方程为：

w·x+b=0

两条边界1L、2L的方程(经过恒等变形后)为：

w·x+b=±1

设x1在1L上，x2在2L上，即：

w·x1+b=1

w·x2+b=-1

两式相减有：

w·(x2-x1)=2

||w||=2/||x2-x1||

式(2-9)左边恰好就是连接x1、x2的向量在划分超平面法方向上的投影，它是最大间隔的二倍。最大间隔等价于求||w||或2||w||或0.5||w||的最小值。考虑到要使所有训练样本点分类正确，应成立：

yi(w·xi+b)≥1

这样，建立线性支持向量机的问题转化为求解二次凸规划问题：

min(1/2||w||^2+C∑ξi)

s.t. yi(w·xi+b)≥1-ξi

ξi≥0

其中C为惩罚系数，ξi为松弛变量。由于目标函数和约束条件都是凸的，根据最优化理论存在全局最小解。应用Lagrange乘子法并考虑满足KKT条件(Karush-Kuhn-Tucker)：

yi(w·xi+b)-1+ξi=0

可求得最优超平面决策函数为：

M(x) = Sgn(∑iαi*yi(xi·x)+b)

*，iα、b为确定最优划分超平面的参数，(xi·x)为两个向量的点积。

对于线性不可分的情况，通过引入松弛变量ξi≥0，修改目标函数和约束条件，应用完全类似的方法可以求解。与式(2-10)类似的新的凸规划问题为：

min(1/2||w||^2+C∑ξi)

s.t. yi(w·xi+b)≥1-ξi

ξi≥0

图像可以提供物体表面的纹理和颜色信息，但是却难以准确描述物体的几何结构和形状。我们可以通过单张图像找到草莓在二维平面内的位置，但是由于深度信息的缺失，我们无法获取其空间位置，从而无法进行草莓目标的位姿估计和采摘点的空间定位。点云数据的补充了图像数据缺少空间三维信息的这一不足，点云数据是离散的三维点，每个点包含其在三维空间中的坐标以及其他属性信息，可以更加准确地描述物体的形状和结构。因此，为了完成草莓目标在三维空间中的位姿估计和分析，引入点云数据是必不可少的环节。

深度相机是一种能够获取场景深度信息的相机，其原理通常是利用红外光或激光束来探测场景中物体的深度。深度相机的深度获取原理主要有光飞行时间(TOF)、结构光编码、以及双目立体视觉等。光飞行时间原理的深度相机，属于主动式测距，相机通过发射一束激光束或红外光脉冲，并测量该光脉冲从发射到反射回来的时间来计算物体表面的深度信息。这种方法需要一个内置的激光器和时间测量传感器。该方式获取的深度不受光照变化和物体纹理的影响，最高可达到厘米级精度，一般使用来测量在一百米之内的较远距离；结构光原理的深度相机，属于主动式测距，相机通过主动投射已知编码图案来照射场景，然后计算这些光线在物体表面上的变形来计算物体表面的深度信息。此方法需要一个内置红外光源和一个红外摄像头。该方式获取的深度同样也不受光照变化和物体纹理的影响，近距离可达到0.01mm-1mm的精度，测量距离一般在10m以内；双目立体视觉的深度相机，属于被动式测距，深度相机使用两个摄像头同时拍摄场景，然后利用特征点匹配算法计算场景中物体的深度信息。该方法需要两个内置摄像头。

清洗后的内容如下：

双目立体视觉深度相机受光照变化和物体纹理变化的影响很大，夜晚无法使用，但在近距离情况下可达到毫米级精度。由于基线限制，一般只能测量较近的距离，范围大多在两米内。本文方法面对的环境为高架栽培草莓种植温室大棚，光照变化范围较大，不适于使用双目立体视觉深度相机。温室内草莓种植高架的行间距在两米左右，需要传感器识别深度的范围也在0.5-2米之间。在此范围内，主动式测距的结构光原理深度相机能达到1mm的高精度，符合采摘应用需求。因此，本文选用使用主动编码原理的深度相机RealSense D415。

RealSense D415可以在获取到RGB图像的同时得到每个像素点的深度信息。其深度感知水平视场角为69.4°、垂直视场角为42.5°、对角线视场角为77°，彩色相机视场角与深度相机视场角一致，分辨率为1920 x 1080，可选自动或手动白平衡和曝光，最大帧率为30fps。

深度数据转换为点云数据本质上是图像坐标系到世界坐标系的变换，变换的约束条件是相机内参。深度相机采集深度信息时，会受到噪声干扰，导致获得的深度信息不准确，进而使点云数据产生误差。点云双边滤波是一种常用的点云滤波方法，利用点云中每个点的领域信息来对该点进行滤波，不仅考虑了点与点之间的距离关系，还考虑了它们在特征空间中的相似度。

点云的法向特征是描述点云表面形状和结构的重要特征之一。计算点云法向量有几种算法，如主成分分析法、平面拟合法等，本文方法对平面拟合法进行展开和推导。

空间射线交点求解是计算机图形学中常用的技术，用于确定一条射线与三维空间中的物体的交点。其原理基于空间向量的运算，可以通过求解一元线性方程组来计算交点。

获得到草莓目标在相机坐标系下的采摘坐标点位置后，需要将其转换到机器人坐标系下，才能引导机器人末端运动到采摘位置，完成采摘动作。这其中会涉及到相机内参标定和机器人手眼标定等步骤。由于同一幅图像中可能会同时采集到多个成熟草莓目标，所以对多个采摘点的排序和路径规划问题，也是值得关注的。

相机内参标定是指确定相机内部参数的过程，其基本步骤如下：准备标定板，拍摄标定板，提取角点，计算内部参数。

采摘机器人手眼标定需要建立起采摘点在相机传感器下坐标与在草莓采摘机器人基坐标系下的映射关系，获得相机与采摘机器人末端坐标系的相对位置关系，从而实现采摘点从相机坐标系到机器人坐标系的转换。

多目标连续采摘的旅行商路径规划问题可以看成是三维空间中的旅行商路径规划问题。旅行商问题的求解主要有精确算法包括分枝定界法、线性规划法、动态规划法等，但是随着问题规模的增大以及城市数量的增加，精确算法便显得无能为力。因此便出现了使用近似算法或启发式算法来解决这一问题的思路，遗传算法将问题的求解过程转换成类似生物进化过程中的染色体基因的交叉、变异等过程。

清洗后的内容如下：

---

个体适应度定义为总距离的倒数。

选择: 将种群中所有个体的适应度值进行累加然后归一化，最终通过随机数对随机数落在区域所对应的个体进行选取。

交叉: 把两个父代个体的部分结构替换重组而形成新的个体。

变异: 对个体上的某些基因值作变动，使能随机搜索到解可能存在的整个空间，一定程度上求得全局最优解。

假设一共有N个采摘点，用P[N,3]表示所有采摘点的空间坐标，D[i,j]来记录每两个采摘点之间的空间距离，迭代优化的采摘点路径被记录在Route[gen]中，M代表种群数量，T代表遗传运算的终止进化代数。则算法伪代码如下：

---

草莓遮挡识别方法

Input: 采摘点空间坐标数组P[N,3],果实数量N Output：Route[i]机器人采摘顺序列表

function Route = TSP_GA(Points,N) 初始化种群规模; 初始化基因交叉概率; 初始化基因变异概率; 随机初始化数量大小为M的种群数组pop; while gen<T

for i=1:M

依次计算种群中个体的评价函数存入fitness数组中; end 将fitness数组累加并归一化,基于概率选择出优秀父代; 选择优秀父代作为后续交叉变异的基础，更新种群; for i=1:M

if rand < 基因交叉概率

执行交叉操作，将相邻优秀父代的路径点中间片段截取交换; end end 更新种群; for i=1:M if rand < 基因变异概率

执行变异操作，随机对种群中优秀父代的内部路径点 end end

保留路径长度最短最好的一代; Route[gen] = 1/min(fitness); gen = gen+1; end

TSP_GA函数输入量为采摘点空间数组，输出为排序后采摘点序列。如上代码所示，首先随机初始化种群，计算出种群中每个个体的适应度函数，根据适应度函数选择优秀个体，并进行交叉变异操作来更新种群，直至迭代进化完成，获取最优路径序列。

---

第二章目标识别与定位方法相关理论

2.5 本章总结

本章首先介绍了目标识别与分割相关的算法理论基础，介绍了图像的色彩空间分析、卷积神经网络和全卷积神经网络主要层级结构以及二者之间的区别和各自的实用场景。其次，介绍了本文方法中需要用到的对草莓目标进行判别分析需要用到的基础理论方法，包括需要用到的图像凸包特征计算方法和支撑向量机分类原理。接着本章介绍了目标定位和点云处理算法相关的内容，包括深度相机的深度信息获取原理和选型依据、深度数据与点云数据的转换、点云的滤波方法、点云的法相特征求解原理以及空间射线交点的求解。最后，本章介绍了采摘动作生成系统的基础理论，包括相机的内参标定原理和机器人手眼标定原理以及多目标连续采摘会涉及到的旅行商路径规划问题。

---

第三章高架栽培草莓自动采摘系统总体方案设计

3.1 草莓自动采摘系统需求分析

草莓自动采摘系统的架构基于场景需求可以分为两个关键部分，即感知系统和执行系统。感知系统负责获取草莓果实的位置信息，而执行系统则根据感知获得的信息实现自动采摘精准动作。在采摘过程中，系统首先通过感知系统观测到果实的位置，然后将手臂移动到果实所在的位置，并使用剪刀等工具将果实剪下。这个过程类似于人工采摘，但自动采摘系统使用机器视觉技术来代替人类的视觉感知，从而实现高效、精准的采摘。

感知系统在获取到目标果实的图像后，将数据转化为执行系统可以接收理解的采摘点信息并反馈给执行系统。执行系统采用逆运动学方法，根据机器人的关节结构和机械特性，计算出每个关节电机所需的位置信息后，机器人就能根据关节位置信息准确地移动手臂和工具，将果实剪下。通过精确的控制和运动规划，执行系统能够高效地实现采摘目标果实的动作。通过循环执行上述工作流程，实现对草莓目标的自动采摘。

3.2 面向自然环境的草莓位姿估计与采摘点定位方案设计

在采摘场景中，光照条件、不同植株的种植需求以及温室大棚在不同时节的影响导致色温、光照强度和果实生长程度存在较大差异。传统图像方法在颜色分割和简单场景下的目标识别上具有优势，但难以处理如此复杂的场景，并且很难通过一套固定参数适应不确定的影响因素。相比之下，深度神经网络具有强大的特征提取能力、环境适应性和鲁棒性，能够准确稳定地识别复杂场景下的语义信息。因此，本文采用传统图像方法与卷积神经网络相结合的方式来解决这一问题。

首先，传统图像方法用于目标识别和初步草莓掩码提取。该方法能够利用颜色分割等技术，在一定程度上处理光照和色温等因素的影响，识别出草莓目标并提取初步的掩码信息。然后，引入卷积神经网络来进一步提取草莓目标的特征和生成精确的掩码。卷积神经网络能够学习复杂的图像特征表示，并具有对环境变化的鲁棒性。通过训练网络模型，系统能够准确地识别草莓目标并生成高质量的掩码，进而基于掩码获得草莓目标曲面的点云数据。

在采摘过程中，由于果实的种植轮次和收获周期等因素的影响，同时识别到的所有草莓并非都适合采摘。为了准确地识别所有草莓，并确定其中可以采摘的草莓，本文提出了基于草莓目标区域边缘和凸包形态以及支持向量机的方法。该方法能够实现草莓果实的可否采摘判别以及遮挡类型判别，并为后续的点云处理工作提供支持。首先，利用机器视觉技术提取草莓目标区域的边缘信息。通过对图像进行处理和分析，可以获得草莓目标的轮廓形状。接下来，通过计算凸包，系统能够进一步理解草莓目标的几何特征和形态信息。同时考虑边缘和凸包形态的方法，能够提供更全面的草莓特征描述。然后，本文采用支持向量机(SVM)算法进行可否采摘判别和遮挡类型判别。通过训练样本的分类特征，建立一个能够判别完整草莓和遮挡草莓的SVM模型。该模型能够利用草莓目标的特征向量进行预测，并确定草莓是否满足采摘条件和草莓是否被遮挡，此部分可使系统可以进一步优化草莓的识别和采摘策略，提高整体采摘效率。

为了让草莓识别不再仅限于研究且真正的能为采摘机器人所用，本文提出了在温室大棚条件下，面向高架栽培草莓的位姿估计和采摘点计算方法。草莓可以近似为一个倒圆锥形的曲面，而在同一个水平面上，草莓点的分布可近似为一个圆形，且圆上的每一条弦的垂线都交于圆心点。本文利用圆锥体的几何性质，将空间果轴比作圆锥体中心的轴线，建立草莓-位姿几何模型。通过计算草莓目标点云数据的法向量，计算法向交点来定量分析草莓曲面、位姿二者之间的关系，推导草莓位姿的计算和采摘点的提取方法。

为了提高采摘机器人的效率，本文研究了一种基于遗传算法的采摘序列路径最短规划方法，用于识别当前视野下的所有可采摘草莓的位姿和采摘点，并规划最优的采摘顺序。首先，采摘机器人通过感知系统获取当前视野下的所有可采摘草莓的位姿和采摘点。然而，如果将这些采摘点无序地发送给采摘机构并执行采摘动作，可能会导致采摘动作的时间和流畅程度受到影响。本文采用遗传算法来进行采摘序列路径的最短规划。将采摘机器人的采摘路径距离作为优化目标，将可采摘草莓的位姿和采摘点作为候选解的基因编码。通过迭代优化的方式不断寻找最短路径，使其能够按照最优顺序采摘草莓，提高采摘效率。

为了让规划生成的采摘序列能够为采摘机器人所用，需要将估计出的草莓位姿和采摘点从相机坐标系转化到机器人坐标系下。为此，本文研究了使用张正友棋盘格标定法进行手眼标定的方法，完成了相机的内参标定，并计算了手眼矩阵。首先，为了实现相机的内参标定，本文采用了张正友棋盘格标定法。通过在场景中放置具有已知尺寸的棋盘格，利用相机拍摄棋盘格的多个图像，可以计算出相机的内参矩阵，包括相机的焦距、主点位置等参数。接下来，利用内参标定得到的相机参数，本文完成了手眼矩阵的计算。手眼矩阵描述了相机坐标系和机器人坐标系之间的转换关系。通过采集相机在不同位置和姿态下的图像，并记录机器人的运动轨迹，可以利用手眼标定方法计算出手眼矩阵，从而将相机坐标系和机器人坐标系进行关联。

综上所述，本文方法主要由四部分组成：自然图像草莓区域分割、草莓目标可采摘性识别、草莓位姿估计与采摘点定位、采摘动作生成，方法结构如图3.1所示。

由图3-1可知，本文方法的流程如下：首先，在自然图像草莓区域分割模块中，以优化的对草莓颜色适应性较高阈值对图像进行阈值分隔获得草莓图像区域预定位；基于预定位结果利用训练好的图像目标识别网络对图像中草莓区域进行快速定位；利用训练好的图像分割网络提取精确的草莓目标区域并提取图像目标区域形状特征。其次，在草莓目标可采摘性识别模块中，使用提取出的图像区域特征对草莓的可采摘性进行识别。然后，在草莓位姿估计模块中，基于草莓区域的点云数据和草莓的可采摘性结果估计草莓位姿和采摘点空间位置坐标；最后，在采摘动作生成模块中，基于计算得到的采摘点序列计算最短采摘路径并控制机器人完成采摘作业。

3.3 本章总结

本章将自动采摘系统的工作过程和人工采摘过程进行类比，将其需求分为了感知模块与执行模块并简单介绍了其所要承担的功能。本文通过结合传统图像方法和卷积神经网络，解决采摘场景中光照条件和复杂环境对草莓识别的挑战。传统图像方法能够处理一定程度上的光照和色温差异，提取初步的草莓目标掩码，而卷积神经网络则进一步提取草莓目标的特征和生成精确的掩码。这种组合方法能够有效地识别复杂场景下的草莓目标，并获取其曲面的点云数据。在采摘过程中，针对果实的种植需求和不同生长程度，本文提出了基于边缘和凸包形态以及支持向量机的可采摘性判别方法，通过机器视觉技术提取草莓目标的边缘信息和凸包形态，结合支持向量机进行分类判别，进一步优化草莓的识别和采摘策略。

此外，针对温室大棚环境下的高架栽培草莓，提出了基于几何模型的位姿估计和采摘点计算方法，利用圆锥体的几何性质建立草莓-位姿模型，并通过计算法向交点实现位姿的计算和采摘点的提取。最后，为提高采摘机器人的效率，本文利用遗传算法进行采摘序列路径最短规划，将可采摘草莓的位姿和采摘点作为候选解进行优化，实现按照最优顺序采摘草莓。此外，通过手眼标定方法，将估计的草莓位姿和采摘点从相机坐标系转化到机器人坐标系，为采摘机器人的实际应用提供支持。综上所述，本文的方案在采摘场景中具有可行性，通过综合应用多种技术手段，能够实现高效、精确的草莓识别和自动采摘，为草莓种植和采摘系统的应用提供了有效的解决方案。

---

第四章草莓图像识别与区域分割方法设计

本文设计了自然环境下草莓目标区域点云的精确分割方法，精确分割的草莓目标点云可为后续的草莓位姿估计提供数据基础，其方法流程如图4-1所示。

首先，在HSV空间对草莓目标进行预定位确定图像中草莓目标潜在区域；其次，利用图像目标识别模型在预定位结果基础上检测草莓位置区域；再次，利用语义分割网络在草莓位置区域图像基础上对草莓区域进行像素分割；使用像素分割后的草莓目标区域图像提取特征进行草莓的成熟性判断；最后，使用成熟草莓的草莓目标区域图像在深度数据中匹配获得草莓目标点云。

4.1 基于目标颜色和饱和度的草莓目标预定位模块

在传统计算机视觉算法中，特征选择是其核心部分，包括纹理特征、形状特征以及颜色特征等等。高架栽培草莓种植温室大棚场景中，草莓的颜色与背景之间存在明显的差异，因此，为了实现准确的目标检测，需要基于合适的颜色空间来进行草莓目标与背景的分离。不同的颜色空间具有不同的通道，如RGB、HSV、YUV等，通过不同颜色和系数的组合，适用于各种不同的应用场景。正如在2.1.1中所分析，成熟草莓目标的红色，在HSV色彩空间中色域较宽、范围较大，草莓前景在S通道下相对于背景也较为显著，较容易提取。又因为温室环境下，光照变化等影响因素较为复杂，无法设定统一参数来适应环境的变化。因此在HSV色彩空间中使用较大的范围的S通道值和红色的颜色提取可较好的完成草莓目标的预定位。利用区域形态学操作完成孔洞填充，去除图像噪声后，获得草莓图像预定位。预定位过程主要由色彩空间转换、颜色提取、饱和度阈值、区域形态学操作、二值图像求交集等过程组成，方法流程如图4-2所示。

其中，在HSV颜色空间中提取的颜色范围为：

[0,10] [156,180]

[43,255]

[46,255]

(4 1) −

HSV空间中提取红色后的二值化图像中，满足式(4-1)条件的像素值为255(白色)，不满足式(4-1)条件的像素值为0(黑色)；S通道分割阈值为140，S通道图中高于此阈值的像素值变为255，低于此阈值的像素值置0。

4.2 基于卷积神经网络的草莓目标识别模块

基于卷积神经网络的模型结构具有深层次、特征表达能力强等特点，能够根据标签自主学习当前任务中所需要的多维特征，比传统方法具有更强的鲁棒性和更大范围的实用性。因此，完成草莓目标的预定位处理后，需要对草莓目标进行目标定位和检测。首先，计算每个预定位目标区域的质心，以区域质心作为中心基于Yolo网络构造识别模块从原始图像中搜索草莓目标。对于预定位过程中正确找到的草莓目标区域，网络会输出草莓目标的预测位置以及置信度；对于预定位过程中误识别的区域，网络无输出，同时也代表着此区域无草莓，不再参与后续流程的计算。

4.2.1 草莓目标识别模块

YOLO算法采用回归的方式进行目标检测，将输入图片划分为7x7的网格，根据每个网格中心点预测周围的目标边框，从而得到目标预测区域的位置信息并预测目标的类别概率。然后将预测区域和类别概率进行对比，得到目标的有效区域。但是，每个网格最多只能预测一个物体，这限制了模型对多目标的识别能力。此外，由于特征网格为7x7，模型对于较小的物体识别能力有限。

YOLOv2是对YOLO算法的优化，其引入了批标准化层提高了网络的收敛性。此外，将输入图片划分为13x13的网格，提高了模型对于较小的物体的支持。YOLOv2还采用了Faster-RCNN中的Anchor boxes，用于预测候选框使得其识别效率高于Faster-RCNN。但是，YOLOv2网络设计中较大的步幅和较少的卷积层还是限制了其对于小目标的检测性能，采用Anchor Boxes的方式虽然提高了检测的精度，但是对于目标形状比较奇异的情况还是会有误检情况。此外，YOLOv2对于长宽比较大的物体的检测也存在一定的问题，容易出现尺度失配的情况。

相对于YOLOv2，YOLOv3在多个方面进行了改进和优化。首先，YOLOv3采用了多尺度检测的策略，可以检测大小不同、宽高比不同的目标。其次，YOLOv3使用残差连接(Residual connections)和特征金字塔(Feature Pyramid)结构，可以在保证高精度的同时大大提高检测速度。此外，YOLOv3使用多尺度训练策略，可以使得模型对于不同大小的目标具有更好的鲁棒性和泛化能力。

因此本文设计了基于YOLOv3的草莓果实识别模块，其流程如图4-3所示：

目标预定位模块输出草莓目标的潜在区域后，以预定位草莓区域的质心为中心并以416x416的尺寸截取原图像，将截取后的图像放入识别网络的输入端。特征提取模块使用Darknet-53来提取图像特征，共52个3x3卷积层和一个1x1卷积层和5个2x2的最大池化层。Yolov3使用Anchor Boxes来检测物体，Anchor Boxes是一组预先定义好的框，可以覆盖各种不同大小和形状的物体。对于每个Anchor Box，YOLOv3会预测其包含物体的置信度和物体的类别，并调整预测框的位置和大小，使其更好地匹配实际目标，在检测到多个Anchor Box都包含同一物体时，网络使用非极大值抑制算法来剔除重复的检测结果，只保留置信度最高的一个结果。

4.2.2 识别网络数据集构建

本文主要针对温室高价栽培种植环境下的草莓果实进行识别，为了保证能够涵盖自然环境下普遍存在的天然干扰信息，选择了不同时间段和不同天气进行数据采集。数据采集地点为北京市昌平区小汤山镇万德草莓庄园，拍摄时间为2022.2.24晴天中午11：00-12：10、2022.2.24晴天下午14：50-15：30和2022.3.6阴天下午16：00-16：45。所使用的数据采集设备型号为Intel的RealSense D415深度相机，相机的图像分辨率和深度信息分辨率都为720x1280像素。

对所有采集图像进行人工挑选，选出包含不同强度光照、不同遮挡情况的图像共2000张，按照8：2的比例划分训练集和测试集，并将1600张训练集图像进行人工标记。

在对草莓目标进行数据标注时，尽量保证标注框与草莓实际大小一致，本文采用Matlab 2021b环境下的Image Labeler软件对训练集图像进行标注，形式如图4-4所示。

4.2.3 识别网络模型训练分析

使用构建好的草莓数据集对目标识别网络进行训练，将预测框与标记框进行比较得出模型的损失函数计算方法为：

---

以上为清洗后的内容。

清洗后的内容如下：

在网络模型训练过程中，使用惯性随机梯度下降法(SGDM)对损失函数进行优化。SGDM在随机梯度下降(SGD)的基础上加入了动量(momentum)的概念。动量可以理解为在梯度下降时加入一定的惯性，使得参数更新不会因为梯度变化太快而波动较大，从而使得收敛更快、更稳定。SGDM的更新公式如下：

1 1 ( ) t t t v v J θ α μ θ − − ∇ = + (4 3) −

1 t t tv θ θ − = − (4 4) −

其中，tv表示第t次迭代时的动量，μ表示动量因子，α表示学习率，1 ( ) t J θ θ − ∇表示损失函数对参数θ的梯度。

草莓目标识别网络模型的训练参数如下表所示：

表4-1 识别网络模型训练参数

训练参数 数值 初始学习率 0.001 训练次数 600 小批次样本数量 16 学习动量 0.9

如表4-1所示，草莓识别网络模型共训练600次，每次训练16张图像，学习率设置为0.001，学习动量设置为0.9，模型训练过程中的损失率与迭代次数关系如图4.5所示：

图4-5 草莓目标识别模型训练损失曲线

根据图4-5可知，在训练过程中，损失率随着迭代次数的增加而下降，到迭代500次后平均损失趋于稳定不再减小。

模型的部分识别结果如图4-6所示：

图4-6 草莓目标识别模块部分识别结果

图4-6中的草莓目标存在光照强、光斑反射、背光和枝叶遮挡等复杂情况。图4-6(a)中三个草莓虽然均存在光斑反射和亮点的情况，但都成功被网络识别，且框选位置与草莓实际大小基本一致；图4-6(b)中的草莓目标光线环境较差，背景背光且十分昏暗，模型仍找到了草莓的目标位置，右上角两个草莓簇拥在一起，导致模型对单个草莓的识别框位置精确度稍差；图4-6(c)中，环境光照程度良好，但草莓果实存在较严重遮挡，也被模型有效识别，且准确率较高。

根据对以上几种较极端情况识别结果的分析，可以看出本节设计的草莓目标识别网络模型对于天气情况变化频繁且存在较多情况干扰的复杂自然环境下，具有较好的准确性与实用性，能够有效完成草莓目标的识别任务。

4.3 基于U-net网络的草莓目标精细定位模块

语义分割技术可以对图像中的目标像素区域进行分割，获得更加精准的草莓有效像素区进而通过三维点云有效分析采摘点信息，卷积神经网络输出草莓目标位置之后，根据草莓识别框的参数对原图像进行剪裁，这样能够去除背景区域对语义分割带来的干扰。由于果实相连、叶片遮挡等原因，识别网络预测的草莓边界框可能会存在未完全包含整个草莓的情况，所以会宽高等比例放大边界框，以保证整个草莓都在图像中。根据放大后边界框的宽高，使用黑色将图像填补为正方形，最后将图像调整至224x224分辨率，输入到草莓语义分割网络中，以获取草莓目标图像。

4.3.1 识别结果图像分割前处理

在进行草莓果实区域的像素分割之前，需要先对原始图像进行分割预处理。为此，设计了图像分割前处理模块，该模块通过草莓识别网络模块输出的果实预测框在图像中的位置、大小和置信度信息，对原始图像进行分割前处理以便进行进一步的像素分割。草莓图像分割前处理模块包括图像剪裁、图像拼接和图像缩放过程，具体流程如图4-7所示：

图4-7 识别结果图像分割前处理流程

如图4-7所示，在草莓识别网络输出结果后，根据草莓识别框的参数对识别框放大后，裁剪图像，以去背景区域的干扰。然而，草莓目标识别网络有可能受到枝叶遮挡、果实遮挡等因素的影响，导致识别框形状各异，无法输入精细分割网络模型。因此，为解决这一问题，通过图像填补算法，根据识别框的宽度和高度差值，使用黑色对其短边方向进行补全。最终，将图像调整至分辨率为224x224，并传入草莓果实分割网络进行下一步操作。

4.3.2 草莓精细分割模块

基于Unet的草莓果实精确分割网络结构，如图4-8所示：

图4-8 识别结果图像分割前处理流程

经过分割预处理模块处理后，得到了224x224像素的草莓识别框图片，该图片将被输入到U-net草莓分割网络模型中。该模型使用3x3的卷积层和2x2的池化层进行了4次下采样，每次下采样前后的图片大小相同。这四次下采样将草莓图像特征图缩小了16倍。接下来，模型使用3x3的卷积层和2x2的反卷积层对高维特征图进行上采样计算。反卷积层使用了补零的步长为2的卷积核构造的2x2反卷积结构，以确保上下采样前后的对称性。在四次下采样前的卷积层输出都被拼接融合到了对称的上采样反卷积后的卷积输入位置。最后，将224x224x32的上一层卷积层的输出通过一个1x1的卷积层输出为一张特征图，每个像素点对应草莓类的得分，越接近1表示该像素点为草莓，接近0表示为背景。将该特征图进行Softmax二值化，得到草莓目标区域分割特征图。

4.3.3 分割网络数据集构建

草莓分割网络数据集来自4.3.1中获得的草莓分割前处理结果图像，为了使数据集具有更好的抗干扰性，标注时包含了光照亮斑、遮挡阴影、枝条枝叶遮挡等果实像素点。数据集总共有5000张图像，标注形式如图4-9(a)所示，使用ImageLabeler标注工具通过人工标记的方式对草莓图像进行标注，标注文件格式为.mat，其描述了草莓图像中的像素标注区域位置信息，将其可视化后，如图4.9(b)所示：

图4-9 分割网络数据集标注示意

4.3.4 分割网络模型训练分析

在草莓目标语义分割网络的训练中，损失函数是通过比较网络输出的分割特征图和标注图像来计算的。该损失用来度量实际值与预测值之间的概率距离，具体的计算方法如下：

[ log( ) (1 )log(1 )]

x loss y p y p

= = + − − ∑ (4 5) −

其中n为BatchSize，即一次循环训练用到的图片数量。p为网络预测值，y为输出期望值。损失函数通过AdaGrad的改进方法Adadelta方法进行优化，其在底t次的参数tθ如下式：

1 [ ] [ ]

t t t t

RMS g RMS g

θ θ − ∆ = ∆ − (4 6) −

1 t t t θ θ θ + = + ∆ (4 7) −

其中tg为梯度参数，其均方根(RMS)为：

2 [ ] [ ] t t RMS E θ θ ε ∆ = ∆ + (4 8) −

Adadelta优化方法的优势在于不需要手动设置学习速率，从而减少了调整学习速率的训练成本，并且相较于AdaGrad鲁棒性更强。

在草莓分割任务中，将数据按照9:1的比例划分为训练集和验证集，经过对草莓分割网络的100个批次的训练，得到了损失曲线如图4-10所示。

图4-10 草莓分割模型训练损失曲线

根据图4-10可知，30轮训练后，网络的泛化能力较强，30轮后面损失率缓慢下降并逐渐稳定。

测试集图像标注和分割预测结果对比如图4-11所示，根据图4-11(a)、(b)、(c)所示，模型成功分割出了图像标注的除果梗外的草莓像素区域，且未收草莓表面光斑的影响。根据图4-11(d)、(e)、(f)可知，模型对遮挡草莓也能给出合理的分割结果。

图4-11 测试集标注图像与分割预测结果图对比

从上述对比结果可知，在光照不均，存在阴影、光强暗淡以及枝叶遮挡情况下，草莓目标分割网络模块均能成功预测草莓目标区域像素位置，具有较好的鲁棒性。

4.3.5 草莓目标的成熟性分析

获得草莓目标的区域分割图像后，应对草莓的成熟性做出分析，以完成后续对成熟草莓目标点云的分割。成熟草莓与未成熟草莓的区域目标图像，如图4.12所示：

图4-12 成熟草莓与未成熟草莓展示

草莓的成熟与否在成熟区域度特征上有明显差异。如图4-12所示，成熟草莓图像的凸包面积，在尺度一致的区域目标图像中，占比较大且较为集中；未成熟草莓图像的凸包面积，在区域目标图像中，占比较小。因此，设1S为草莓目标区域凸包像素面积,2S为目标图像像素面积，以1/2/F为草莓的成熟区域度特征。通过对草莓样本图像的分析，获取其目标区域并计算区域度特征，将特征数据1F生成了箱型图如图4-13所示：

图4-13 草莓区域度特征分布箱型图

图4-13中，纵轴为区域度特征1F的数值，从图中可以观察到未成熟草莓的区域度特征分布集中度较高，均分布在0.08左右。而成熟草莓的区域度较为分散，从最小值0.18到最大值0.72均有分布，相对集中在0.35-0.5区间。因草莓样本的多样性及其品质的随机性，所得数据中有个别离群点(红色十字)，但图中数据分布仍能反应出可通过区域度特征阈值方法成功区分成熟草莓与未成熟草莓。当把阈值设定在0.2时，对成熟草莓分类的准确率为96.03%，对未成熟草莓分类的准确率为91.67%，满足实际场景的应用需求。

4.3.6 草莓目标点云的精细分割及去噪

成熟草莓中，以草莓目标精确分割区域像素的坐标为索引，结合配准的深度信息矩阵，结合2.3.2中的式(2-14)计算草莓区域的点云数据，获得精确分割的草莓目标区域点云数据。如图4.14所示：

图4-14 草莓目标点云数据获取

此时得到的点云曲面数据，是不够平滑的，不足以拟合草莓曲面的平滑程度。因此，为了去除点云数据在获取阶段受到环境干扰导致的误差，需要对点云数据进行预处理。本文使用双边滤波方法对草莓目标点云区域进行滤波去噪，双边滤波算法通过使用当前数据点与临近点的距离权重和临近点沿当前点法向量的投影权重来修正当前采样中心点的位置，从而达到保持点云数据原特征的目的。根据2.3.3的分析和推导，使用此方法平滑后的数据对比如图4-15所示：

图4-15 草莓曲面点云数据经双边滤波后效果对比图

根据图4-15(a)和图4-15(a1)可知，由于传感器精度和环境光学噪声干扰等原因，草莓目标原始点云呈现阶梯状，且点云边缘存在毛边现象。由图4-15(b)和图4-15(b1)所示，对原始点云数据进行双边滤波可有效的消减点云的噪声，是点云数据表面变得平滑，增强数据的可用性。

4.4 目标区域及点云分割系统测试分析

在测试数据中，选用了不同环境条件下，以及不同成熟程度，不同遮挡情况下的草莓图像来评估草莓目标区域分割模块的性能，测试结果如图4-16所示：

图4-16 不同条件下草莓区域分割测试结果

图4-16(a)为弱光照条件下的草莓目标区域点云分割测试结果，得到了正确的草莓目标区域并精准分割目标点云。图4-16(b)为有枝叶遮挡的情况，本文设计的点云分割模块获得了合理的预测结果，还原了图像中草莓所属的像素区域，并成功获得遮挡草莓的目标点云。图4-16(c)为强光照射情况，模块也表现出了较好的分割能力，没有受到光斑的影响。图4-16(d)为强光照射且有枝叶遮挡的条件下，模块的分割结果仍较为准确。从以上测试结果看，本文设计的方法对温室环境下图像的草莓目标点云分割具有较好的适应性。

4.5 本章总结

本章将草莓目标区域精细分割分成了三大步，分别是基于颜色分割与饱和度阈值的草莓目标预定位、基于卷积神经网络的草莓目标识别模块以及基于全卷积神经网络的草莓目标区域像素精细分割模块。完成草莓目标区域图像的精细分割后，对草莓目标区域在点云空间中进行分割和滤波，其中，还涉及到了对分割出的目标区域的草莓进行成熟性判别，以更好的完成草莓目标点云的提取和分割。最后对整个草莓目标区域精细分割系统进行了测试，测试结果表明，本文设计的草莓目标区域精细分割系统对自然环境具有较高的适用性和鲁棒性，可成功完成草莓目标区域的精细分割和点云分割任务。

第五章草莓果实空间姿态与采摘点识别方法设计

5.1 草莓果实空间姿态估计

5.1.1 点云预处理

5.1.2 草莓目标识别与分割

5.1.3 草莓位姿估计

5.1.4 遮挡草莓位姿估计

5.1.5 采摘点获取

5.2 动作生成系统软件设计

5.2.1 坐标空间转换

5.2.2 采摘顺序分析

5.3 位姿估计与采摘点定位测试分析

5.4 真实采摘测试

5.5 本章总结

第六章总结与展望

6.1 已有工作总结

6.2 未来改进方向

本文方法框架流程连续，各个环节紧密配合，成功实现草莓采摘点的空间定位，完成采摘动作。未来需增强算法的通用性与模块间独立性，提高稳定性和鲁棒性。研究指出，为实现草莓完全自主采摘，需对果园机器人移动平台技术进行深入研究，确保移动平台能在果园畅行无阻，承载采摘平台进行作业。

参考文献：
[1]蓝峰,苏子昊,黎子明,谢舒.果园采摘机械的现状及发展趋势[J].农机化研究,2010,32(11):249-252.
[2]徐明东,邱立涛,曲文浩,冀年源,于杨青.草莓采摘机器人的系统研究设计[J].机械研究与应用,2022,35(01):136-138+144.
[3]冯青春,郑文刚,姜凯,邱权,郭瑞.高架栽培草莓采摘机器人系统设计[J].农机化研究,2012,34(07):122-126.
[4]赵世达.基于机器视觉的草莓识别技术研究[D].武汉轻工大学,2018.
[5]谢志勇,张铁中,赵金英.基于Hough变换的成熟草莓识别技术[J].农业机械学报,2007(03):106-109.
…（以下省略其他参考文献编号，以“…”代替）

多项研究涉及草莓识别与定位方法，包括机器视觉、Hough变换、卷积神经网络等技术的应用。为实现自动采摘，还需关注果园机器人移动平台技术，确保其能在复杂环境中准确进行果实定位与采摘。